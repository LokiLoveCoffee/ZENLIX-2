$(document).ready(function(){function e(e,t){$.ajax({type:"POST",url:N,data:"mode=get_noty_actions&type="+e+"&ticket_id="+t,dataType:"json",success:function(e){e&&$.each(e,function(e,t){var o="<div style='float: left;'><a style='color: rgb(243, 235, 235); cursor: inherit;' target='_blank' href='"+t.url+"ticket?"+t.hash+"'><strong>"+t.ticket+" #"+t.name+"</strong> </a></div><div style='float: right; padding-right: 10px;'><small>"+t.time+"</small></div><br><hr style='margin-top: 5px; margin-bottom: 8px; border:0; border-top:0px solid #E4E4E4'><em style='color: rgb(252, 252, 252); cursor: inherit;'>"+t.at+"</em>";noty({text:o,layout:USER_noty_layot,timeout:!1}),$.ionSound.play("button_tiny"),$.titleAlert(t.up),n(!0)})}})}function t(e){$.ajax({type:"POST",url:N,data:"mode=get_chat_message&msg_id="+e,dataType:"json",success:function(e){e&&$.each(e,function(e,t){var o="<div style='float: left;'><a style='color: rgb(243, 235, 235); cursor: inherit;' target='_blank' href='messages?to="+t.uniq_id+"'><strong><i class='fa fa-comments'></i> "+t.new_msg_text+"</strong> </a></div><div style='float: right; padding-right: 10px;'><small>"+t.time_op+"</small></div><br><hr style='margin-top: 5px; margin-bottom: 8px; border:0; border-top:0px solid #E4E4E4'><strong>"+t.user_from+":</strong><em style='color: rgb(252, 252, 252); cursor: inherit;'> "+t.user_chat+"</em>";noty({text:o,layout:USER_noty_layot,timeout:!1}),$.ionSound.play("button_tiny"),n(!0)})}})}function o(e){var t=$("#target_user").val();e==t&&$.ajax({type:"POST",url:N,data:"mode=messages_view&target="+t,success:function(e){$("#content_chat").html(e),n(!0);var t=$("#content_chat"),o=t[0].scrollHeight;t.scrollTop(o)}})}function a(){$(".pops2").popover({html:!0,trigger:"manual",container:$(this).attr("id"),placement:"bottom",content:function(){$return='<div class="hover-hovercard"></div>'}}).on("mouseenter",function(){var e=this;$(this).popover("show"),$(this).siblings(".popover").on("mouseleave",function(){$(e).popover("hide")})}).on("mouseleave",function(){var e=this;setTimeout(function(){$(".popover:hover").length||$(e).popover("hide")},100)}),$(".pops").popover({html:!0,trigger:"manual",container:$(this).attr("id"),placement:"right",content:function(){$return='<div class="hover-hovercard"></div>'}}).on("mouseenter",function(){var e=this;$(this).popover("show"),$(this).siblings(".popover").on("mouseleave",function(){$(e).popover("hide")})}).on("mouseleave",function(){var e=this;setTimeout(function(){$(".popover:hover").length||$(e).popover("hide")},100)})}function n(){var e=moment().zone("+04:00");String.prototype.toHHMMSS=function(){var e=parseInt(this,10),t=Math.floor(e/3600),o=Math.floor((e-3600*t)/60),a=e-3600*t-60*o;10>t&&(t="0"+t),10>o&&(o="0"+o),10>a&&(a="0"+a);var n=t+":"+o+":"+a;return n},$("time#a").each(function(t,o){var a=moment($(o).attr("datetime"));$(o).html("<span>"+a.from(e)+"</span>")}),$("time#b").each(function(t,o){var a=moment($(o).attr("datetime"));$(o).html("<span>"+a.from(e)+"</span>")}),$("time#c").each(function(e,t){var o=moment($(t).attr("datetime"));$(t).html("<span>"+o.format("ddd, Do MMM, H:mm:ss")+"</span>")}),$("time#d").each(function(e,t){var o=moment($(t).attr("datetime"));$(t).html("<span>"+o.format("dddd, Do MMMM")+"</span>")}),$("time#e").each(function(e,t){var o=moment($(t).attr("datetime"));$(t).html("<span>"+o.format("H:mm:ss")+"</span>")}),$("time#f").each(function(e,t){var o=$(t).attr("datetime"),a=moment.duration(1e3*o,"milliseconds");$(t).html("<span>"+a.format("d "+MOMENTJS_DAY+", h "+MOMENTJS_HOUR+", m "+MOMENTJS_MINUTE+", s "+MOMENTJS_SEC)+"</span>")})}function s(){var e="",t="",o=window.location.href;return o.search("inc")>=0&&(t="../"),$.ajax({type:"POST",url:N,data:"mode=get_host_conf",async:!1,success:function(t){e=t}}),e}function i(e){var t=e.element;return"<i class='fa fa-user status_icon_"+$(t).data("foo")+"'></i> "+e.text}function l(e,t,o){data=new FormData,data.append("file",e),data.append("mode","summernote_file_add"),$.ajax({data:data,type:"POST",url:N,cache:!1,contentType:!1,processData:!1,success:function(e){t.insertImage(o,e)}})}function r(e){var t="",o="",a=window.location.href;return a.search("inc")>=0&&(o="../"),$.ajax({type:"POST",url:N,data:"mode=get_lang_param&param="+encodeURIComponent(e),async:!1,success:function(e){t=e}}),t}function c(e,t){$.ajax({type:"POST",url:N,data:"mode=get_users_list&unit="+encodeURIComponent(e),dataType:"json",success:function(e){$("select#"+t).empty(),e&&($("select#"+t).append($("<option></option>")),$.each(e,function(e,o){$("select#"+t).append($("<option></option>").attr("value",o.co).attr("data-foo",o.stat).text(o.name))})),$("select#"+t).trigger("change")}})}function d(e){var t=window.location.href,o=!1;return t.search(e)>=0&&(o=!0),o}function u(){setInterval(function(){$.ajax({type:"POST",url:N,data:"mode=update_status_time",success:function(){n(!0)}})},6e4)}function p(e){var t=$("#ticket_hash").val(),o=$("#ticket_id").val();e==o&&setInterval(function(){0==$("input#msg:focus").length&&(window.location=MyHOSTNAME+"ticket?"+t+"&refresh")},1e3)}function _(e){$.ajax({type:"POST",url:N,data:"mode=view_comment&tid="+e,success:function(e){$("#comment_content").html(e),n(!0);var t=$("#comment_body"),o=t[0].scrollHeight;t.scrollTop(o)}})}function m(){$.ajax({type:"POST",url:N,data:"mode=get_tt_label",success:function(e){$("#tt_label").html(e)}})}function f(){$.ajax({type:"POST",url:N,data:"mode=recalculate_messages",success:function(e){$("#label_msg").html(e)}})}function h(){$.ajax({type:"POST",url:N,data:"mode=update_dashboard_labels",dataType:"json",success:function(e){e&&$.each(e,function(e,t){$("h3#tool_1").html(t.tool1),$("h3#tool_2").html(t.tool2),$("h3#tool_3").html(t.tool3),$("h3#tool_4").html(t.tool4)})}})}function v(){var e=$("#curent_page").attr("value"),t=$("#page_type").attr("value");$.ajax({type:"POST",url:MyHOSTNAME+"inc/models/list_content.inc.php",data:"menu="+encodeURIComponent(t)+"&page="+encodeURIComponent(e),success:function(e){$('[data-toggle="tooltip"]').tooltip("hide"),$("#content").html(e),$('[data-toggle="tooltip"]').tooltip({container:"body",html:!0}),n(!0)}})}function g(){$.ajax({type:"POST",url:N,data:"mode=dashboard_t",success:function(e){$("#dashboard_t").html(e),$("#spinner").hide(),$('[data-toggle="tooltip"]').tooltip("hide"),$('[data-toggle="tooltip"]').tooltip({container:"body",html:!0}),n(!0)}})}function b(){$.ajax({type:"POST",url:N,data:"mode=message_user_list",success:function(e){$("#user_list").html(e)}})}function y(){$("#unread_msg").show,$.ajax({type:"POST",url:N,data:"mode=view_unread_msgs_labels",success:function(e){$(".label_unread_msg").html(e)}}),$.ajax({type:"POST",url:N,data:"mode=view_unread_msgs_total",success:function(e){$("#nav_t_msgs").html(e)}}),$.ajax({type:"POST",url:N,data:"mode=view_unread_msgs",success:function(e){$("#unread_msgs_content").html(e),n(!0)}})}function C(){var e=$("#total_msgs_main").val(),t=$("#target_user").val();$.ajax({type:"POST",url:N,data:"mode=total_msgs_main",success:function(o){e!=o&&"main"==t&&$.ajax({type:"POST",url:N,data:"mode=messages_view&target=main",success:function(e){$("#content_chat").html(e),n(!0);var t=$("#content_chat"),o=t[0].scrollHeight;t.scrollTop(o)}})}})}function k(){window.location=MyHOSTNAME+"news"}function x(){$.fn.editable.defaults.mode="inline",$("a#edit_item").each(function(e,t){$(t).editable({inputclass:"input-sm",emptytext:"пусто",params:{mode:"save_helper_item"}})}),$(".sortable").nestedSortable({ForcePlaceholderSize:!0,handle:"div",helper:"clone",items:"li",opacity:.6,placeholder:"placeholder",revert:250,tabSize:25,tolerance:"pointer",toleranceElement:"> div",maxLevels:4,update:function(){list=$(this).nestedSortable("serialize"),$.post(N,{mode:"sort_units_helper",list:list},function(e){console.log(e)})}})}function w(){if("true"==$("#work_timer").attr("value")){var e=$("#work_timer > #f").attr("datetime");e++,$("#work_timer > #f").attr("datetime",e);var t=$("#work_timer > time#f").attr("datetime"),o=moment.duration(1e3*t,"milliseconds");$("#work_timer > time#f").html("<span>"+o.format("d "+MOMENTJS_DAY+", h "+MOMENTJS_HOUR+", m "+MOMENTJS_MINUTE+", s "+MOMENTJS_SEC)+"</span>")}}function S(){if("true"==$("#deadline_timer").attr("value")){var e=$("#deadline_timer > #f").attr("datetime");e--,$("#deadline_timer > #f").attr("datetime",e);var t=$("#deadline_timer > time#f").attr("datetime"),o=moment.duration(1e3*t,"milliseconds");$("#deadline_timer > time#f").html("<span>"+o.format("d "+MOMENTJS_DAY+", h "+MOMENTJS_HOUR+", m "+MOMENTJS_MINUTE+", s "+MOMENTJS_SEC)+"</span>")}}function T(){var e=$("#do_comment_file").prop("files")[0],t=$("#ticket_hash").val(),o=new FormData;o.append("file",e),o.append("mode","attach_file_comment"),o.append("tid",t),$.ajax({url:N,dataType:"text",cache:!1,contentType:!1,processData:!1,data:o,type:"post",success:function(e){$("#comment_content").html(e),$("input#msg").val(""),$(".file-input-name").text(""),n(!0);var t=$("#comment_body"),o=t[0].scrollHeight;t.scrollTop(o)}})}function I(){var e=($("#username").text(),$("#subj").val()),t=$("select#to").val(),o=$("#msg").val().length,a=0;return 0==$("#fio").val().length&&(a=1,$("#for_fio").addClass("has-error"),setTimeout(function(){$("#fio").popover("hide")},2e3)),"0"==t&&(a=1,$("#for_to").addClass("has-error"),setTimeout(function(){$("#dsd").popover("hide")},2e3)),(null==e||"0"==e)&&(a=1,$("#for_subj").addClass("has-error"),setTimeout(function(){$("#for_subj").popover("hide")},2e3)),0==o&&(a=1,$("#for_msg").addClass("has-error"),setTimeout(function(){$("textarea#msg").popover("hide")},2e3)),a}function R(){var e=$("#subj").val(),t=$("select#to").val(),o=$("#msg").val().length,a=0;return $("#s_start").length&&($("button#start_upload").popover("show"),a=1),$("#s_start").length||($("button#start_upload").popover("hide"),a=0),"0"==t&&(a=1,$("#dsd").popover("show"),$("#for_to").addClass("has-error")),0==e&&(a=1,$("#for_subj").popover("show"),$("#for_subj").addClass("has-error")),0==o&&(a=1,$("#msg").popover("show"),$("#for_msg").addClass("has-error")),a}function O(){var e,t=$("#d_finish_val").val(),o=$("#add_field_form").serialize();null==$("#users_do").val()?e="0":null!=$("#users_do").val()&&(e=$("#users_do").val()),$("#enter_ticket").html('<i class="fa fa-spinner fa-spin"></i>').prop("disabled",!0),$("#reset_ticket").prop("disabled",!0),$.ajax({type:"POST",url:N,data:"mode=add_ticket&type_add=client&user_init_id="+encodeURIComponent($("#user_init_id").val())+"&user_do="+encodeURIComponent(e)+"&subj="+encodeURIComponent($("#subj").val())+"&msg="+encodeURIComponent($("#msg").val())+"&unit_id="+encodeURIComponent($("#to").val())+"&prio="+encodeURIComponent($("#prio").val())+"&hashname="+encodeURIComponent($("#hashname").val())+"&deadline_time="+t+"&"+o,success:function(e){window.location=MyHOSTNAME+"create?ok&h="+e}})}function U(){var e,t=$("#status_action").val(),o=$("#d_finish_val").val(),a=$("#add_field_form").serialize();"add"==t&&($("#enter_ticket").html('<i class="fa fa-spinner fa-spin"></i>').prop("disabled",!0),$("#reset_ticket").prop("disabled",!0),null==$("#users_do").val()?e="0":null!=$("#users_do").val()&&(e=$("#users_do").val()),$.ajax({type:"POST",url:N,data:"mode=add_ticket&type_add=add&fio="+encodeURIComponent($("#username").text())+"&tel="+encodeURIComponent($("#new_tel").text())+"&login="+encodeURIComponent($("#new_login").text())+"&pod="+encodeURIComponent($("#new_unit").text())+"&adr="+encodeURIComponent($("#new_adr").text())+"&tel="+encodeURIComponent($("#new_tel").text())+"&mail="+encodeURIComponent($("#new_mail").text())+"&posada="+encodeURIComponent($("#new_posada").text())+"&user_init_id="+encodeURIComponent($("#user_init_id").val())+"&user_do="+encodeURIComponent(e)+"&subj="+encodeURIComponent($("#subj").val())+"&msg="+encodeURIComponent($("#msg").val())+"&unit_id="+encodeURIComponent($("#to").val())+"&prio="+encodeURIComponent($("#prio").val())+"&hashname="+encodeURIComponent($("#hashname").val())+"&deadline_time="+o+"&"+a,success:function(e){window.location=MyHOSTNAME+"create?ok&h="+e}})),"edit"==t&&($("#enter_ticket").html('<i class="fa fa-spinner fa-spin"></i>').prop("disabled",!0),$("#reset_ticket").prop("disabled",!0),null==$("#users_do").val()?e="0":null!=$("#users_do").val()&&(e=$("#users_do").val()),$.ajax({type:"POST",url:N,data:"mode=add_ticket&type_add=edit&client_id_param="+encodeURIComponent($("#client_id_param").val())+"&tel="+encodeURIComponent($("#edit_tel").text())+"&login="+encodeURIComponent($("#edit_login").text())+"&pod="+encodeURIComponent($("#edit_unit").text())+"&adr="+encodeURIComponent($("#edit_adr").text())+"&tel="+encodeURIComponent($("#edit_tel").text())+"&mail="+encodeURIComponent($("#edit_mail").text())+"&posada="+encodeURIComponent($("#edit_posada").text())+"&user_init_id="+encodeURIComponent($("#user_init_id").val())+"&user_do="+encodeURIComponent(e)+"&subj="+encodeURIComponent($("#subj").val())+"&msg="+encodeURIComponent($("#msg").val())+"&unit_id="+encodeURIComponent($("#to").val())+"&prio="+encodeURIComponent($("#prio").val())+"&hashname="+encodeURIComponent($("#hashname").val())+"&deadline_time="+o+"&"+a,success:function(e){window.location=MyHOSTNAME+"create?ok&h="+e}}))}function j(){$.fn.editable.defaults.mode="inline",$("a#edit_item").each(function(e,t){$(t).editable({inputclass:"form-control input-sm input-longtext",emptytext:"пусто",params:{mode:"save_sla_item"},tpl:"<input type='text' style='width: 400px'>"})}),$(".sortable").nestedSortable({ForcePlaceholderSize:!0,handle:"div",helper:"clone",items:"li",opacity:.6,placeholder:"placeholder",revert:250,tabSize:25,tolerance:"pointer",toleranceElement:"> div",maxLevels:1,update:function(){list=$(this).nestedSortable("serialize"),$.post(N,{mode:"sort_sla_plans",list:list},function(e){console.log(e)})}}),$("input[type='checkbox']:not(.simple), input[type='radio']:not(.simple)").iCheck({checkboxClass:"icheckbox_minimal",radioClass:"iradio_minimal"})}function M(e){e.each(function(){var e={title:$.trim($(this).text())};$(this).data("eventObject",e),$(this).draggable({zIndex:1070,revert:!0,revertDuration:0})})}function P(e){$("#calendar").fullCalendar("destroy"),$("#calendar").fullCalendar({header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},firstDay:1,lang:"MyLANG",timeFormat:"H(:mm)",buttonText:{today:CAL_today,month:CAL_month,week:CAL_week,day:CAL_day},eventSources:[{url:N,type:"POST",data:{mode:"get_cal_events",filter:e},error:function(){alert("there was an error while fetching events!")}}],editable:!0,droppable:!0,eventClick:function(e){0==e.editable?$.ajax({url:N,data:{mode:"get_cal_event",uniq_code:e.id},type:"POST",dataType:"json",success:function(e){$.each(e,function(e,t){$("#ei_name").text(t.title),$("#ei_desc").text(t.description),$("#ei_period").text(t.period),$("#ei_author").html(t.author)}),$("#event_modal_info").modal("show")}}):1==e.editable&&($.ajax({url:N,data:{mode:"get_cal_event",uniq_code:e.id},type:"POST",dataType:"json",success:function(e){$.each(e,function(e,t){$("#event_name").val(t.title),$("#event_desc").val(t.description),$("#visibility").val(t.visibility),$("#current_backgroundColor").val(t.backgroundColor),$("#current_borderColor").val(t.borderColor),$("#cur_color_event").css({"background-color":t.backgroundColor,"border-color":t.borderColor}),$("#reservation").val(t.start+" - "+t.end),$("#current_start").val(t.start),$("#current_end").val(t.end),1==t.allDay?($("input#all_day").iCheck("check"),$("#reservation").prop("disabled",!0)):0==t.allDay&&($("input#all_day").iCheck("uncheck"),$("#reservation").prop("disabled",!1))})}}),$("#current_event_hash").val(e.id),$("#event_modal").modal("show"))},drop:function(e,t){var o=$(this).data("eventObject"),a=$.extend({},o);a.start=e,a.allDay=t,a.backgroundColor=$(this).css("background-color"),a.borderColor=$(this).css("border-color"),$.ajax({url:N,data:{mode:"cal_insert_events",title:a.title,start:e.format(),end:e.format(),backgroundColor:$(this).css("background-color"),borderColor:$(this).css("border-color")},type:"POST",success:function(){}}),P("0,1,2"),$(".make_event_filter").iCheck("check"),$("#drop-remove").is(":checked")&&$(this).remove()},eventDrop:function(e){var t=moment(e.start).format("YYYY-MM-DD HH:mm:ss"),o=null==e.end?t:e.end.format();$.ajax({url:N,data:{mode:"cal_drop_events",title:e.title,start:t,end:o,id:e.id,allday:e.allDay},type:"POST",success:function(){}})},eventResize:function(e){var t=moment(e.start).format("YYYY-MM-DD HH:mm:ss"),o=moment(e.end).format("YYYY-MM-DD HH:mm:ss");$.ajax({url:N,data:{mode:"cal_resize_events",title:e.title,start:t,end:o,id:e.id,allday:e.allDay},type:"POST",success:function(){}})},eventRender:function(e,t){t.popover({title:e.name,html:!0,trigger:"manual",placement:"top",title:e.title,content:"<small>"+e.description+"</small>"}).on("mouseenter",function(){var e=this;$(this).popover("show"),$(this).siblings(".popover").on("mouseleave",function(){$(e).popover("hide")})}).on("mouseleave",function(){var e=this;setTimeout(function(){$(".popover:hover").length||$(e).popover("hide")},100)})}})}function D(){$.fn.editable.defaults.mode="inline",$("a#edit_item").each(function(e,t){$(t).editable({inputclass:"form-control input-sm input-longtext",emptytext:"пусто",params:{mode:"save_subj_item"},tpl:"<input type='text' style='width: 450px'>"})}),$(".sortable").nestedSortable({ForcePlaceholderSize:!0,handle:"div",helper:"clone",items:"li",opacity:.6,placeholder:"placeholder",revert:250,tabSize:25,tolerance:"pointer",toleranceElement:"> div",maxLevels:1,update:function(){list=$(this).nestedSortable("serialize"),$.post(N,{mode:"sort_sla",list:list},function(e){console.log(e)})}}),$("input[type='checkbox']:not(.simple), input[type='radio']:not(.simple)").iCheck({checkboxClass:"icheckbox_minimal",radioClass:"iradio_minimal"})}$.ajaxSetup({cache:!1}),console.log(window.location.href),$(".main_i").css("display","none"),$(".main_i").fadeIn(800),$(".mf").css("display","none"),$(".mf").fadeIn(800),$("input[type='checkbox']:not(.simple), input[type='radio']:not(.simple)").iCheck({checkboxClass:"icheckbox_minimal",radioClass:"iradio_minimal"});var H=io.connect(NODE_URL,{secure:!0});H.emit("join",{uniq_id:USER_HASH}),H.on("new_msg",function(a){switch(a.type_op){case"ticket_create":a.zen_sid!=ZENLIX_session_id&&(a.user_init!=USER_HASH&&e("ticket_create",a.t_id),m(),("dashboard"==z||window.location==MyHOSTNAME||"index.php"==z)&&(g(),n(!0),h()),d("list")&&(v(),n(!0)),d("news")&&k());break;case"ticket_refer":a.zen_sid!=ZENLIX_session_id&&(a.user_init!=USER_HASH&&e("ticket_refer",a.t_id),m(),("dashboard"==z||window.location==MyHOSTNAME||"index.php"==z)&&(g(),n(!0),h()),d("list")&&(v(),n(!0)),d("ticket")&&p(a.t_id),d("news")&&k());break;case"ticket_ok":a.zen_sid!=ZENLIX_session_id&&(a.user_init!=USER_HASH&&e("ticket_ok",a.t_id),("dashboard"==z||window.location==MyHOSTNAME||"index.php"==z)&&(g(),n(!0),m(),h()),d("list")&&(v(),n(!0),m()),d("ticket")&&(p(a.t_id),m()),d("news")&&k());break;case"ticket_no_ok":a.zen_sid!=ZENLIX_session_id&&(a.user_init!=USER_HASH&&e("ticket_no_ok",a.t_id),("dashboard"==z||window.location==MyHOSTNAME||"index.php"==z)&&(g(),n(!0),m(),h()),d("list")&&(v(),n(!0),m()),d("ticket")&&(p(a.t_id),m()),d("news")&&k());break;case"ticket_lock":a.zen_sid!=ZENLIX_session_id&&(console.log("data.user_init:"+a.user_init+"| USER_HASH:"+USER_HASH),a.user_init!=USER_HASH&&e("ticket_lock",a.t_id),("dashboard"==z||window.location==MyHOSTNAME||"index.php"==z)&&(g(),n(!0),h()),d("list")&&(v(),n(!0)),d("ticket")&&p(a.t_id),d("news")&&k());break;case"ticket_unlock":a.zen_sid!=ZENLIX_session_id&&(a.user_init!=USER_HASH&&e("ticket_unlock",a.t_id),("dashboard"==z||window.location==MyHOSTNAME||"index.php"==z)&&(g(),n(!0),h()),d("list")&&(v(),n(!0)),d("ticket")&&p(a.t_id),d("news")&&k());break;case"ticket_comment":a.zen_sid!=ZENLIX_session_id&&(a.user_init!=USER_HASH&&(d("ticket")||e("ticket_comment",a.t_id)),d("ticket")&&$("#ticket_id").val()==a.t_id&&(_(a.t_id),n(!0)),d("news")&&k());break;case"message_send":USER_HASH!=a.user_hash&&a.zen_sid!=ZENLIX_session_id&&(d("messages")||a.user_init!=USER_HASH&&t(a.chat_id),d("messages")&&o(a.t_id),f(),y(),d("messages")&&b());break;case"logout":window.location=MyHOSTNAME+"logout"}}),moment.lang(MyLANG);var E={fio:!1,login:!1,pass:!1},N=MyHOSTNAME+"action";$('[data-toggle="tooltip"]').tooltip({container:"body",html:!0});var A=function(){$(".chosen-select").find("option:selected").attr("id")};$(".chosen-select").chosen({no_results_text:r("JS_not_found"),allow_single_deselect:!0}),$(".chosen-select").chosen().change(A),$("#spinner").hide(),$.ionSound({sounds:["button_tiny"]});var Y=window.location.pathname.split("/"),z=Y[Y.length-1];if($.noty.defaults={layout:USER_noty_layot,theme:"relax",type:"information",text:"",closeButton:!0,dismissQueue:!0,template:'<div class="noty_message"><span class="noty_text"></span><div class="noty_close"><i class="fa fa-times"></i></div></div>',animation:{open:{height:"toggle"},close:{height:"toggle"},easing:"swing",speed:500},timeout:!1,force:!1,modal:!1,maxVisible:5,killer:!1,closeWith:["button"],callback:{onShow:function(){},afterShow:function(){},onClose:function(){},afterClose:function(){}},buttons:!1},n(!0),a(),u(),$("body").on("click","#show_online_users",function(e){e.preventDefault(),$.ajax({type:"POST",url:N,data:"mode=show_online_users",success:function(e){$("#online_users_content").html(e)}}),$.ajax({type:"POST",url:N,data:"mode=count_online_users",success:function(e){$(".online_users_label").html(e)}})}),d("news")&&$(".fancybox").fancybox({openEffect:"elastic",closeEffect:"elastic"}),d("scheduler")&&($("body").on("click","button#cron_delete",function(e){e.preventDefault();var t=$(this).attr("value");bootbox.confirm(r("JS_del"),function(e){1==e&&$.ajax({type:"POST",url:N,data:"mode=cron_del&id="+t,success:function(){window.location=MyHOSTNAME+"scheduler"}}),0==e&&console.log("false")})}),$("body").on("click","button#add_scheduler",function(e){e.preventDefault(),$.ajax({type:"POST",url:N,dataType:"json",data:"mode=add_cron&client_id_param="+$("#client_id_param").val()+"&to="+$("#to").val()+"&s2id_users_do="+$("#users_do").val()+"&prio="+$("#prio").val()+"&subj="+$("#subj").val()+"&msg="+$("#msg").val()+"&period="+$("#period").val()+"&day_field="+$("#day_field").val()+"&week_select="+$("#week_select").val()+"&month_select="+$("#month_select").val()+"&time_action="+$("#time_action").val()+"&action_start="+$("#action_start").val()+"&action_stop="+$("#action_stop").val()+"&status_action="+$("#status_action").val(),success:function(e){$.each(e,function(e,t){1==t.check_error?window.location=MyHOSTNAME+"scheduler":0==t.check_error&&$("#error_content").html(t.msg)})}})}),$(".timepicker").timepicker({showInputs:!1,minuteStep:1,showSeconds:!0,showMeridian:!1}),$("#reservation").on("apply.daterangepicker",function(e,t){$("#action_start").val(t.startDate.format("YYYY-MM-DD HH:mm:ss")),$("#action_stop").val(t.endDate.format("YYYY-MM-DD HH:mm:ss"))}),$("#reservation").daterangepicker({format:"YYYY-MM-DD HH:mm:ss",timePicker:!0,timePicker12Hour:!1}),$("#period_week").hide(),$("#period_month").hide(),$("body").on("click","button#btn_period_day",function(e){e.preventDefault(),$("button#btn_period_day").addClass("active"),$("button#btn_period_week").removeClass("active"),$("button#btn_period_month").removeClass("active"),$("#period_day").show(),$("#period_week").hide(),$("#period_month").hide(),$("#period").val("day")}),$("body").on("click","button#btn_period_week",function(e){e.preventDefault(),$("button#btn_period_day").removeClass("active"),$("button#btn_period_week").addClass("active"),$("button#btn_period_month").removeClass("active"),$("#period_day").hide(),$("#period_week").show(),$("#period_month").hide(),$("#period").val("week")}),$("body").on("click","button#btn_period_month",function(e){e.preventDefault(),$("button#btn_period_day").removeClass("active"),$("button#btn_period_week").removeClass("active"),$("button#btn_period_month").addClass("active"),$("#period_day").hide(),$("#period_week").hide(),$("#period_month").show(),$("#period").val("month")}),$("select#users_do").change(function(){var e=$("select#users_do").val(),t=$("select#to").val();0==t&&(0!=e&&$.ajax({type:"POST",url:N,data:"mode=get_unit_id&uid="+e,success:function(e){$("select#to [value='"+e+"']").attr("selected","selected"),$("select#to").trigger("chosen:updated"),$("#for_to").popover("hide"),$("#for_to").removeClass("has-error"),$("#for_to").addClass("has-success")}}),0==e&&($("select#to").find("option:selected").removeAttr("selected"),$("select#to").trigger("chosen:updated")))}),$("select#to").on("change",function(){0!=$("select#to").val()?($("#for_to").popover("hide"),$("#for_to").removeClass("has-error"),$("#for_to").addClass("has-success"),$("#dsd").popover("hide")):($("#dsd").popover("show"),$("#for_to").popover("show"),$("#for_to").addClass("has-error"),setTimeout(function(){$("#dsd").popover("hide")},2e3))}),$("select#to").change(function(){var e=$("select#to").val();0!=$("select#to").val()?($("#for_to").popover("hide"),$("#for_to").removeClass("has-error"),$("#for_to").addClass("has-success"),c(e,"users_do")):(c(e,"users_do"),$("#for_to").popover("show"),$("#for_to").addClass("has-error"),setTimeout(function(){$("#for_to").popover("hide")},2e3))}),$("body").on("click","a#select_init_user",function(e){e.preventDefault(),console.log($(this).attr("param-hash"));var t=$("#user_name_login").val(),o=$("#user_init_id").val();$("#fio").popover("hide"),$("#for_fio").removeClass("has-error").addClass("has-success"),$("#user_info").hide().fadeIn(500),$("#alert_add").hide(),$.ajax({type:"POST",url:N,data:"mode=get_client_from_new_t&get_my_info=0",success:function(e){$("#client_id_param").val(o),$("#fio").val(t),$("#user_info").hide().html(e).fadeIn(500),$("#for_fio").addClass("has-success"),$("#status_action").val("edit"),n(!0)}})}),$("body").on("click","button#prio_low",function(e){e.preventDefault(),$("button#prio_low").addClass("active"),$("button#prio_normal").removeClass("active"),$("button#prio_high").removeClass("active"),$("i#lprio_low").addClass("fa fa-check"),$("i#lprio_norm").removeClass("fa fa-check"),$("i#lprio_high").removeClass("fa fa-check"),$("#prio").val("0")}),$("body").on("click","button#prio_normal",function(e){e.preventDefault(),$("button#prio_low").removeClass("active"),$("button#prio_normal").addClass("active"),$("button#prio_high").removeClass("active"),$("i#lprio_low").removeClass("fa fa-check"),$("i#lprio_norm").addClass("fa fa-check"),$("i#lprio_high").removeClass("fa fa-check"),$("#prio").val("1")}),$("body").on("click","button#prio_high",function(e){e.preventDefault(),$("button#prio_low").removeClass("active"),$("button#prio_normal").removeClass("active"),$("button#prio_high").addClass("active"),$("i#lprio_low").removeClass("fa fa-check"),$("i#lprio_norm").removeClass("fa fa-check"),$("i#lprio_high").addClass("fa fa-check"),$("#prio").val("2")}),$("body").on("click","button#reset_cron",function(e){e.preventDefault(),window.location=MyHOSTNAME+"scheduler?plus"}),$("#user_info").hide(),$("#alert_add").hide(),$("#users_do").select2({formatResult:i,formatSelection:i,allowClear:!0,maximumSelectionSize:15,width:"100%",formatNoMatches:r("JS_not_found"),escapeMarkup:function(e){return e}}),$("textarea").autosize({append:"\n"}),$("#fio").autocomplete({max:10,minLength:2,source:MyHOSTNAME+"/inc/json.php?fio",focus:function(e,t){return $("#fio").val(t.item.label),!1},select:function(e,t){return $("#fio").val(t.item.label),$("#client_id_param").val(t.item.value),$("#fio").popover("hide"),$("#for_fio").removeClass("has-error").addClass("has-success"),$("#user_info").hide().fadeIn(500),$("#alert_add").hide(),$.ajax({type:"POST",url:N,data:"mode=get_client_from_new_t&get_client_info="+t.item.value,success:function(e){$("#user_info").hide().html(e).fadeIn(500),$("#edit_login").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#edit_posada").editable({inputclass:"input-sm",emptytext:"пусто",mode:"popup",showbuttons:!1}),$("#edit_unit").editable({inputclass:"input-sm",emptytext:"пусто",mode:"popup",showbuttons:!1}),$("#edit_tel").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#edit_adr").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#edit_mail").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#for_fio").addClass("has-success"),$("#status_action").val("edit"),n(!0)}}),!1},change:function(e,t){0!=$("input#fio").val().length&&null==t.item&&$.ajax({type:"POST",dataType:"json",url:N,data:"mode=find_client&cron=true&name="+encodeURIComponent($("#fio").val()),success:function(e){$.each(e,function(e,t){1==t.res&&($("#client_id_param").val(t.p),$("#fio").popover("hide"),$("#for_fio").removeClass("has-error").addClass("has-success"),$("#user_info").hide().fadeIn(500),$("#alert_add").hide(),$.ajax({type:"POST",url:N,data:"mode=get_client_from_new_t&get_client_info="+encodeURIComponent(t.p),success:function(e){$("#user_info").hide().html(e).fadeIn(500),$("#edit_login").editable({type:"text",pk:1,url:N,inputclass:"input-sm",emptytext:"пусто",params:{mode:"verify_login_nt"}}),$("#edit_posada").editable({inputclass:"input-sm",emptytext:"пусто",mode:"popup",showbuttons:!1}),$("#edit_unit").editable({inputclass:"input-sm",emptytext:"пусто",mode:"popup",showbuttons:!1}),$("#edit_tel").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#edit_adr").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#edit_mail").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#for_fio").addClass("has-success"),$("#status_action").val("edit"),n(!0)}})),0==t.res&&(1==t.priv&&($("#user_info").hide(),$("#fio").popover("hide"),$("#for_fio").removeClass("has-error"),$("#for_fio").addClass("has-success"),$("#status_action").val("add"),$.ajax({type:"POST",url:N,data:"mode=get_client_from_new_t&new_client_info="+encodeURIComponent($("#fio").val()),success:function(e){$("#user_info").hide().html(e).fadeIn(500),$("#username").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#new_login").editable({type:"text",pk:1,url:N,inputclass:"input-sm",emptytext:"пусто",params:{mode:"verify_login_nt"}}),$("#new_posada").editable({inputclass:"input-sm posada_class",emptytext:"пусто",mode:"popup",showbuttons:!1}),$("#new_unit").editable({inputclass:"input-sm",emptytext:"пусто",mode:"popup",showbuttons:!1}),$("#new_tel").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#new_adr").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#new_mail").editable({inputclass:"input-sm",emptytext:"пусто"}),n(!0)}})),0==t.priv&&($("#user_info").hide(),$("#user_info").hide().html(t.msg_error).fadeIn(500),$("#status_action").val(""),$("#fio").val(""),n(!0)))})}})}})),d("sla_rep")&&($("#unitstat_id").select2({allowClear:!0,maximumSelectionSize:15,formatNoMatches:r("JS_not_found")}),$("#reservation").on("apply.daterangepicker",function(e,t){$("#start_time").val(t.startDate.format("YYYY-MM-DD")),$("#stop_time").val(t.endDate.format("YYYY-MM-DD"))}),$("#reservation").daterangepicker({format:"YYYY-MM-DD"}),$("body").on("click","button#sla_stat_make",function(e){e.preventDefault();var t=$("#unitstat_id").val(),o=$("#start_time").val(),a=$("#stop_time").val();$.ajax({type:"POST",url:N,data:"mode=get_sla_period_stat&start="+o+"&end="+a+"&unit="+t,success:function(e){$("#ts_res").html(e),$(".knob").knob(),n()}})})),d("main_stats")&&($("#unitstat_id").select2({allowClear:!0,maximumSelectionSize:15,formatNoMatches:r("JS_not_found")}),$("body").on("click","button#main_stat_make",function(e){e.preventDefault();var t=$("#unitstat_id").val(),o=$("#start_time").val(),a=$("#stop_time").val();$.ajax({type:"POST",url:N,data:"mode=get_total_period_stat&start="+o+"&end="+a+"&unit="+t,success:function(e){$("#ts_res").html(e),$(".knob").knob(),n()}})}),$("#reservation").on("apply.daterangepicker",function(e,t){$("#start_time").val(t.startDate.format("YYYY-MM-DD")),$("#stop_time").val(t.endDate.format("YYYY-MM-DD"))}),$("#reservation").daterangepicker({format:"YYYY-MM-DD"})),d("user_stats")&&($("#user_list").select2({formatResult:i,formatSelection:i,allowClear:!0,maximumSelectionSize:15,width:"100%",formatNoMatches:r("JS_not_found"),escapeMarkup:function(e){return e
