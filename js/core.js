$(document).ready(function(){function e(e,t){$.ajax({type:"POST",url:j,data:"mode=get_noty_actions&type="+e+"&ticket_id="+t,dataType:"json",success:function(e){e&&$.each(e,function(e,t){var o="<div style='float: left;'><a style='color: rgb(243, 235, 235); cursor: inherit;' target='_blank' href='"+t.url+"/ticket?"+t.hash+"'><strong>"+t.ticket+" #"+t.name+"</strong> </a></div><div style='float: right; padding-right: 10px;'><small>"+t.time+"</small></div><br><hr style='margin-top: 5px; margin-bottom: 8px; border:0; border-top:0px solid #E4E4E4'><em style='color: rgb(252, 252, 252); cursor: inherit;'>"+t.at+"</em>";noty({text:o,layout:USER_noty_layot,timeout:!1}),$.ionSound.play("button_tiny"),$.titleAlert(t.up),n(!0)})}})}function t(e){$.ajax({type:"POST",url:j,data:"mode=get_chat_message&msg_id="+e,dataType:"json",success:function(e){e&&$.each(e,function(e,t){var o="<div style='float: left;'><a style='color: rgb(243, 235, 235); cursor: inherit;' target='_blank' href='messages?to="+t.uniq_id+"'><strong><i class='fa fa-comments'></i> "+t.new_msg_text+"</strong> </a></div><div style='float: right; padding-right: 10px;'><small>"+t.time_op+"</small></div><br><hr style='margin-top: 5px; margin-bottom: 8px; border:0; border-top:0px solid #E4E4E4'><strong>"+t.user_from+":</strong><em style='color: rgb(252, 252, 252); cursor: inherit;'> "+t.user_chat+"</em>";noty({text:o,layout:USER_noty_layot,timeout:!1}),$.ionSound.play("button_tiny"),n(!0)})}})}function o(e){var t=$("#target_user").val();e==t&&$.ajax({type:"POST",url:j,data:"mode=messages_view&target="+t,success:function(e){$("#content_chat").html(e),n(!0);var t=$("#content_chat"),o=t[0].scrollHeight;t.scrollTop(o)}})}function a(){$(".pops").popover({html:!0,trigger:"manual",container:$(this).attr("id"),placement:"right",content:function(){$return='<div class="hover-hovercard"></div>'}}).on("mouseenter",function(){var e=this;$(this).popover("show"),$(this).siblings(".popover").on("mouseleave",function(){$(e).popover("hide")})}).on("mouseleave",function(){var e=this;setTimeout(function(){$(".popover:hover").length||$(e).popover("hide")},100)})}function n(){var e=moment().zone("+04:00");$("time#a").each(function(t,o){var a=moment($(o).attr("datetime"));$(o).html("<span>"+a.from(e)+"</span>")}),$("time#b").each(function(t,o){var a=moment($(o).attr("datetime"));$(o).html("<span>"+a.from(e)+"</span>")}),$("time#c").each(function(e,t){var o=moment($(t).attr("datetime"));$(t).html("<span>"+o.format("ddd, Do MMM, H:mm:ss")+"</span>")}),$("time#d").each(function(e,t){var o=moment($(t).attr("datetime"));$(t).html("<span>"+o.format("dddd, Do MMMM")+"</span>")})}function s(){var e="",t="",o=window.location.href;return o.search("inc")>=0&&(t="../"),$.ajax({type:"POST",url:j,data:"mode=get_host_conf",async:!1,success:function(t){e=t}}),e}function i(e){var t=e.element;return"<i class='fa fa-user status_icon_"+$(t).data("foo")+"'></i> "+e.text}function l(e,t,o){data=new FormData,data.append("file",e),$.ajax({data:data,type:"POST",url:MyHOSTNAME+"sys/up_summernote.php",cache:!1,contentType:!1,processData:!1,success:function(e){t.insertImage(o,e)}})}function c(e){var t="",o="",a=window.location.href;return a.search("inc")>=0&&(o="../"),$.ajax({type:"POST",url:j,data:"mode=get_lang_param&param="+encodeURIComponent(e),async:!1,success:function(e){t=e}}),t}function r(e,t){$.ajax({type:"POST",url:j,data:"mode=get_users_list&unit="+encodeURIComponent(e),dataType:"json",success:function(e){$("select#"+t).empty(),e&&($("select#"+t).append($("<option></option>")),$.each(e,function(e,o){$("select#"+t).append($("<option></option>").attr("value",o.co).attr("data-foo",o.stat).text(o.name))})),$("select#"+t).trigger("change")}})}function d(e){var t=window.location.href,o=!1;return t.search(e)>=0&&(o=!0),o}function u(){setInterval(function(){$.ajax({type:"POST",url:j,data:"mode=update_status_time",success:function(){n(!0)}})},6e4)}function p(e){var t=$("#ticket_hash").val(),o=$("#ticket_id").val();e==o&&setInterval(function(){0==$("input#msg:focus").length&&(window.location=MyHOSTNAME+"ticket?"+t+"&refresh")},1e3)}function m(e){$.ajax({type:"POST",url:j,data:"mode=view_comment&tid="+e,success:function(e){$("#comment_content").html(e),n(!0);var t=$("#comment_body"),o=t[0].scrollHeight;t.scrollTop(o)}})}function _(){$.ajax({type:"POST",url:j,data:"mode=get_tt_label",success:function(e){$("#tt_label").html(e)}})}function f(){$.ajax({type:"POST",url:j,data:"mode=recalculate_messages",success:function(e){$("#label_msg").html(e)}})}function h(){$.ajax({type:"POST",url:j,data:"mode=update_dashboard_labels",dataType:"json",success:function(e){e&&$.each(e,function(e,t){$("h3#tool_1").html(t.tool1),$("h3#tool_2").html(t.tool2),$("h3#tool_3").html(t.tool3),$("h3#tool_4").html(t.tool4)})}})}function v(){var e=$("#curent_page").attr("value"),t=$("#page_type").attr("value");$.ajax({type:"POST",url:MyHOSTNAME+"inc/list_content.inc.php",data:"menu="+encodeURIComponent(t)+"&page="+encodeURIComponent(e),success:function(e){$('[data-toggle="tooltip"]').tooltip("hide"),$("#content").html(e),$('[data-toggle="tooltip"]').tooltip({container:"body",html:!0})}})}function g(){$.ajax({type:"POST",url:j,data:"mode=dashboard_t",success:function(e){$("#dashboard_t").html(e),$("#spinner").hide(),$('[data-toggle="tooltip"]').tooltip("hide"),$('[data-toggle="tooltip"]').tooltip({container:"body",html:!0}),n(!0)}})}function b(){$.ajax({type:"POST",url:j,data:"mode=message_user_list",success:function(e){$("#user_list").html(e)}})}function y(){$("#unread_msg").show,$.ajax({type:"POST",url:j,data:"mode=view_unread_msgs_labels",success:function(e){$(".label_unread_msg").html(e)}}),$.ajax({type:"POST",url:j,data:"mode=view_unread_msgs_total",success:function(e){$("#nav_t_msgs").html(e)}}),$.ajax({type:"POST",url:j,data:"mode=view_unread_msgs",success:function(e){$("#unread_msgs_content").html(e),n(!0)}})}function C(){var e=$("#total_msgs_main").val(),t=$("#target_user").val();$.ajax({type:"POST",url:j,data:"mode=total_msgs_main",success:function(o){e!=o&&"main"==t&&$.ajax({type:"POST",url:j,data:"mode=messages_view&target=main",success:function(e){$("#content_chat").html(e),n(!0);var t=$("#content_chat"),o=t[0].scrollHeight;t.scrollTop(o)}})}})}function k(){window.location=MyHOSTNAME+"news"}function x(){$.fn.editable.defaults.mode="inline",$("a#edit_item").each(function(e,t){$(t).editable({inputclass:"input-sm",emptytext:"пусто",params:{mode:"save_helper_item"}})}),$(".sortable").nestedSortable({ForcePlaceholderSize:!0,handle:"div",helper:"clone",items:"li",opacity:.6,placeholder:"placeholder",revert:250,tabSize:25,tolerance:"pointer",toleranceElement:"> div",maxLevels:4,update:function(){list=$(this).nestedSortable("serialize"),$.post(j,{mode:"sort_units_helper",list:list},function(e){console.log(e)})}})}function w(){var e=$("#do_comment_file").prop("files")[0],t=$("#ticket_hash").val(),o=new FormData;o.append("file",e),o.append("mode","attach_file_comment"),o.append("tid",t),$.ajax({url:j,dataType:"text",cache:!1,contentType:!1,processData:!1,data:o,type:"post",success:function(e){$("#comment_content").html(e),$("input#msg").val(""),n(!0);var t=$("#comment_body"),o=t[0].scrollHeight;t.scrollTop(o)}})}function I(){var e=($("#username").text(),$("#subj").val()),t=$("select#to").val(),o=$("#msg").val().length,a=0;return $("#s_start").length&&($("button#start_upload").popover("show"),a=1),$("#s_start").length||($("button#start_upload").popover("hide"),a=0),0==$("#fio").val().length&&(a=1,$("#fio").popover("show"),$("#for_fio").addClass("has-error"),setTimeout(function(){$("#fio").popover("hide")},2e3)),"0"==t&&(a=1,$("#dsd").popover("show"),$("#for_to").addClass("has-error"),setTimeout(function(){$("#dsd").popover("hide")},2e3)),null==e&&(a=1,$("#for_subj").popover("show"),$("#for_subj").addClass("has-error"),setTimeout(function(){$("#for_subj").popover("hide")},2e3)),0==o&&(a=1,$("#msg").popover("show"),$("#for_msg").addClass("has-error"),setTimeout(function(){$("textarea#msg").popover("hide")},2e3)),a}function S(){var e=$("#subj").val(),t=$("select#to").val(),o=$("#msg").val().length,a=0;return $("#s_start").length&&($("button#start_upload").popover("show"),a=1),$("#s_start").length||($("button#start_upload").popover("hide"),a=0),"0"==t&&(a=1,$("#dsd").popover("show"),$("#for_to").addClass("has-error")),0==e&&(a=1,$("#for_subj").popover("show"),$("#for_subj").addClass("has-error")),0==o&&(a=1,$("#msg").popover("show"),$("#for_msg").addClass("has-error")),a}function T(){var e;null==$("#users_do").val()?e="0":null!=$("#users_do").val()&&(e=$("#users_do").val()),$("#enter_ticket").html('<i class="fa fa-spinner fa-spin"></i>').prop("disabled",!0),$("#reset_ticket").prop("disabled",!0),$.ajax({type:"POST",url:j,data:"mode=add_ticket&type_add=client&user_init_id="+encodeURIComponent($("#user_init_id").val())+"&user_do="+encodeURIComponent(e)+"&subj="+encodeURIComponent($("#subj").val())+"&msg="+encodeURIComponent($("#msg").val())+"&unit_id="+encodeURIComponent($("#to").val())+"&prio="+encodeURIComponent($("#prio").val())+"&hashname="+encodeURIComponent($("#hashname").val()),success:function(e){window.location=MyHOSTNAME+"create?ok&h="+e}})}function R(){var e,t=$("#status_action").val(),o=$("#d_finish_val").val();"add"==t&&($("#enter_ticket").html('<i class="fa fa-spinner fa-spin"></i>').prop("disabled",!0),$("#reset_ticket").prop("disabled",!0),null==$("#users_do").val()?e="0":null!=$("#users_do").val()&&(e=$("#users_do").val()),$.ajax({type:"POST",url:j,data:"mode=add_ticket&type_add=add&fio="+encodeURIComponent($("#username").text())+"&tel="+encodeURIComponent($("#new_tel").text())+"&login="+encodeURIComponent($("#new_login").text())+"&pod="+encodeURIComponent($("#new_unit").text())+"&adr="+encodeURIComponent($("#new_adr").text())+"&tel="+encodeURIComponent($("#new_tel").text())+"&mail="+encodeURIComponent($("#new_mail").text())+"&posada="+encodeURIComponent($("#new_posada").text())+"&user_init_id="+encodeURIComponent($("#user_init_id").val())+"&user_do="+encodeURIComponent(e)+"&subj="+encodeURIComponent($("#subj").val())+"&msg="+encodeURIComponent($("#msg").val())+"&unit_id="+encodeURIComponent($("#to").val())+"&prio="+encodeURIComponent($("#prio").val())+"&hashname="+encodeURIComponent($("#hashname").val())+"&deadline_time="+o,success:function(e){window.location=MyHOSTNAME+"create?ok&h="+e}})),"edit"==t&&($("#enter_ticket").html('<i class="fa fa-spinner fa-spin"></i>').prop("disabled",!0),$("#reset_ticket").prop("disabled",!0),null==$("#users_do").val()?e="0":null!=$("#users_do").val()&&(e=$("#users_do").val()),$.ajax({type:"POST",url:j,data:"mode=add_ticket&type_add=edit&client_id_param="+encodeURIComponent($("#client_id_param").val())+"&tel="+encodeURIComponent($("#edit_tel").text())+"&login="+encodeURIComponent($("#edit_login").text())+"&pod="+encodeURIComponent($("#edit_unit").text())+"&adr="+encodeURIComponent($("#edit_adr").text())+"&tel="+encodeURIComponent($("#edit_tel").text())+"&mail="+encodeURIComponent($("#edit_mail").text())+"&posada="+encodeURIComponent($("#edit_posada").text())+"&user_init_id="+encodeURIComponent($("#user_init_id").val())+"&user_do="+encodeURIComponent(e)+"&subj="+encodeURIComponent($("#subj").val())+"&msg="+encodeURIComponent($("#msg").val())+"&unit_id="+encodeURIComponent($("#to").val())+"&prio="+encodeURIComponent($("#prio").val())+"&hashname="+encodeURIComponent($("#hashname").val())+"&deadline_time="+o,success:function(e){window.location=MyHOSTNAME+"create?ok&h="+e}}))}$.ajaxSetup({cache:!1}),$(".right-side").css("display","none"),$(".right-side").fadeIn(800);var U=io.connect(NODE_URL,{secure:!0});U.emit("join",{uniq_id:USER_HASH}),U.on("new_msg",function(a){switch(a.type_op){case"ticket_create":e("ticket_create",a.t_id),_(),("index.php"==D||window.location==MyHOSTNAME)&&(g(),n(!0),h()),d("list")&&(v(),n(!0)),d("news")&&k();break;case"ticket_refer":e("ticket_refer",a.t_id),_(),("index.php"==D||window.location==MyHOSTNAME)&&(g(),n(!0),h()),d("list")&&(v(),n(!0)),d("ticket")&&p(a.t_id),d("news")&&k();break;case"ticket_ok":e("ticket_ok",a.t_id),("index.php"==D||window.location==MyHOSTNAME)&&(g(),n(!0),_(),h()),d("list")&&(v(),n(!0),_()),d("ticket")&&(p(a.t_id),_()),d("news")&&k();break;case"ticket_no_ok":e("ticket_no_ok",a.t_id),("index.php"==D||window.location==MyHOSTNAME)&&(g(),n(!0),_(),h()),d("list")&&(v(),n(!0),_()),d("ticket")&&(p(a.t_id),_()),d("news")&&k();break;case"ticket_lock":e("ticket_lock",a.t_id),("index.php"==D||window.location==MyHOSTNAME)&&(g(),n(!0),h()),d("list")&&(v(),n(!0)),d("ticket")&&p(a.t_id),d("news")&&k();break;case"ticket_unlock":e("ticket_unlock",a.t_id),("index.php"==D||window.location==MyHOSTNAME)&&(g(),n(!0),h()),d("list")&&(v(),n(!0)),d("ticket")&&p(a.t_id),d("news")&&k();break;case"ticket_comment":e("ticket_comment",a.t_id),d("ticket")&&$("#ticket_id").val()==a.t_id&&(m(a.t_id),n(!0)),d("news")&&k();break;case"message_send":d("messages")||t(a.chat_id),d("messages")&&o(a.t_id),f(),y(),d("messages")&&b();break;case"logout":window.location=MyHOSTNAME+"index.php?logout"}}),moment.lang(MyLANG);var O={fio:!1,login:!1,pass:!1},j=MyHOSTNAME+"actions.php";$('[data-toggle="tooltip"]').tooltip({container:"body",html:!0});var P=function(){$(".chosen-select").find("option:selected").attr("id")};$(".chosen-select").chosen({no_results_text:c("JS_not_found"),allow_single_deselect:!0}),$(".chosen-select").chosen().change(P),$("#spinner").hide(),$.ionSound({sounds:["button_tiny"]});var M=window.location.pathname.split("/"),D=M[M.length-1];if($.noty.defaults={layout:USER_noty_layot,theme:"relax",type:"information",text:"",closeButton:!0,dismissQueue:!0,template:'<div class="noty_message"><span class="noty_text"></span><div class="noty_close"><i class="fa fa-times"></i></div></div>',animation:{open:{height:"toggle"},close:{height:"toggle"},easing:"swing",speed:500},timeout:!1,force:!1,modal:!1,maxVisible:5,killer:!1,closeWith:["button"],callback:{onShow:function(){},afterShow:function(){},onClose:function(){},afterClose:function(){}},buttons:!1},n(!0),a(),u(),$("body").on("click","#show_online_users",function(e){e.preventDefault(),$.ajax({type:"POST",url:j,data:"mode=show_online_users",success:function(e){$("#online_users_content").html(e)}}),$.ajax({type:"POST",url:j,data:"mode=count_online_users",success:function(e){$(".online_users_label").html(e)}})}),d("scheduler")&&($("body").on("click","button#cron_delete",function(e){e.preventDefault();var t=$(this).attr("value");bootbox.confirm(c("JS_del"),function(e){1==e&&$.ajax({type:"POST",url:j,data:"mode=cron_del&id="+t,success:function(){window.location=MyHOSTNAME+"scheduler"}}),0==e&&console.log("false")})}),$("body").on("click","button#add_scheduler",function(e){e.preventDefault(),$.ajax({type:"POST",url:j,dataType:"json",data:"mode=add_cron&client_id_param="+$("#client_id_param").val()+"&to="+$("#to").val()+"&s2id_users_do="+$("#users_do").val()+"&prio="+$("#prio").val()+"&subj="+$("#subj").val()+"&msg="+$("#msg").val()+"&period="+$("#period").val()+"&day_field="+$("#day_field").val()+"&week_select="+$("#week_select").val()+"&month_select="+$("#month_select").val()+"&time_action="+$("#time_action").val()+"&action_start="+$("#action_start").val()+"&action_stop="+$("#action_stop").val()+"&status_action="+$("#status_action").val(),success:function(e){$.each(e,function(e,t){1==t.check_error?window.location=MyHOSTNAME+"scheduler":0==t.check_error&&$("#error_content").html(t.msg)})}})}),$(".timepicker").timepicker({showInputs:!1,minuteStep:1,showSeconds:!0,showMeridian:!1}),$("#reservation").on("apply.daterangepicker",function(e,t){$("#action_start").val(t.startDate.format("YYYY-MM-DD HH:mm:ss")),$("#action_stop").val(t.endDate.format("YYYY-MM-DD HH:mm:ss"))}),$("#reservation").daterangepicker({format:"YYYY-MM-DD HH:mm:ss",timePicker:!0,timePicker12Hour:!1}),$("#period_week").hide(),$("#period_month").hide(),$("body").on("click","button#btn_period_day",function(e){e.preventDefault(),$("button#btn_period_day").addClass("active"),$("button#btn_period_week").removeClass("active"),$("button#btn_period_month").removeClass("active"),$("#period_day").show(),$("#period_week").hide(),$("#period_month").hide(),$("#period").val("day")}),$("body").on("click","button#btn_period_week",function(e){e.preventDefault(),$("button#btn_period_day").removeClass("active"),$("button#btn_period_week").addClass("active"),$("button#btn_period_month").removeClass("active"),$("#period_day").hide(),$("#period_week").show(),$("#period_month").hide(),$("#period").val("week")}),$("body").on("click","button#btn_period_month",function(e){e.preventDefault(),$("button#btn_period_day").removeClass("active"),$("button#btn_period_week").removeClass("active"),$("button#btn_period_month").addClass("active"),$("#period_day").hide(),$("#period_week").hide(),$("#period_month").show(),$("#period").val("month")}),$("select#users_do").change(function(){var e=$("select#users_do").val(),t=$("select#to").val();0==t&&(0!=e&&$.ajax({type:"POST",url:j,data:"mode=get_unit_id&uid="+e,success:function(e){$("select#to [value='"+e+"']").attr("selected","selected"),$("select#to").trigger("chosen:updated"),$("#for_to").popover("hide"),$("#for_to").removeClass("has-error"),$("#for_to").addClass("has-success")}}),0==e&&($("select#to").find("option:selected").removeAttr("selected"),$("select#to").trigger("chosen:updated")))}),$("select#to").on("change",function(){0!=$("select#to").val()?($("#for_to").popover("hide"),$("#for_to").removeClass("has-error"),$("#for_to").addClass("has-success"),$("#dsd").popover("hide")):($("#dsd").popover("show"),$("#for_to").popover("show"),$("#for_to").addClass("has-error"),setTimeout(function(){$("#dsd").popover("hide")},2e3))}),$("select#to").change(function(){var e=$("select#to").val();0!=$("select#to").val()?($("#for_to").popover("hide"),$("#for_to").removeClass("has-error"),$("#for_to").addClass("has-success"),r(e,"users_do")):(r(e,"users_do"),$("#for_to").popover("show"),$("#for_to").addClass("has-error"),setTimeout(function(){$("#for_to").popover("hide")},2e3))}),$("body").on("click","a#select_init_user",function(e){e.preventDefault(),console.log($(this).attr("param-hash"));var t=$("#user_name_login").val(),o=$("#user_init_id").val();$("#fio").popover("hide"),$("#for_fio").removeClass("has-error").addClass("has-success"),$("#user_info").hide().fadeIn(500),$("#alert_add").hide(),$.ajax({type:"POST",url:j,data:"mode=get_client_from_new_t&get_my_info=0",success:function(e){$("#client_id_param").val(o),$("#fio").val(t),$("#user_info").hide().html(e).fadeIn(500),$("#for_fio").addClass("has-success"),$("#status_action").val("edit"),n(!0)}})}),$("body").on("click","button#prio_low",function(e){e.preventDefault(),$("button#prio_low").addClass("active"),$("button#prio_normal").removeClass("active"),$("button#prio_high").removeClass("active"),$("i#lprio_low").addClass("fa fa-check"),$("i#lprio_norm").removeClass("fa fa-check"),$("i#lprio_high").removeClass("fa fa-check"),$("#prio").val("0")}),$("body").on("click","button#prio_normal",function(e){e.preventDefault(),$("button#prio_low").removeClass("active"),$("button#prio_normal").addClass("active"),$("button#prio_high").removeClass("active"),$("i#lprio_low").removeClass("fa fa-check"),$("i#lprio_norm").addClass("fa fa-check"),$("i#lprio_high").removeClass("fa fa-check"),$("#prio").val("1")}),$("body").on("click","button#prio_high",function(e){e.preventDefault(),$("button#prio_low").removeClass("active"),$("button#prio_normal").removeClass("active"),$("button#prio_high").addClass("active"),$("i#lprio_low").removeClass("fa fa-check"),$("i#lprio_norm").removeClass("fa fa-check"),$("i#lprio_high").addClass("fa fa-check"),$("#prio").val("2")}),$("body").on("click","button#reset_cron",function(e){e.preventDefault(),window.location=MyHOSTNAME+"scheduler?plus"}),$("#user_info").hide(),$("#alert_add").hide(),$("#users_do").select2({formatResult:i,formatSelection:i,allowClear:!0,maximumSelectionSize:15,width:"100%",formatNoMatches:c("JS_not_found"),escapeMarkup:function(e){return e}}),$("textarea").autosize({append:"\n"}),$("#fio").autocomplete({max:10,minLength:2,source:MyHOSTNAME+"/inc/json.php?fio",focus:function(e,t){return $("#fio").val(t.item.label),!1},select:function(e,t){return $("#fio").val(t.item.label),$("#client_id_param").val(t.item.value),$("#fio").popover("hide"),$("#for_fio").removeClass("has-error").addClass("has-success"),$("#user_info").hide().fadeIn(500),$("#alert_add").hide(),$.ajax({type:"POST",url:j,data:"mode=get_client_from_new_t&get_client_info="+t.item.value,success:function(e){$("#user_info").hide().html(e).fadeIn(500),$("#edit_login").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#edit_posada").editable({inputclass:"input-sm",emptytext:"пусто",mode:"popup",showbuttons:!1}),$("#edit_unit").editable({inputclass:"input-sm",emptytext:"пусто",mode:"popup",showbuttons:!1}),$("#edit_tel").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#edit_adr").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#edit_mail").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#for_fio").addClass("has-success"),$("#status_action").val("edit"),n(!0)}}),!1},change:function(e,t){0!=$("input#fio").val().length&&null==t.item&&$.ajax({type:"POST",dataType:"json",url:j,data:"mode=find_client&cron=true&name="+encodeURIComponent($("#fio").val()),success:function(e){$.each(e,function(e,t){1==t.res&&($("#client_id_param").val(t.p),$("#fio").popover("hide"),$("#for_fio").removeClass("has-error").addClass("has-success"),$("#user_info").hide().fadeIn(500),$("#alert_add").hide(),$.ajax({type:"POST",url:j,data:"mode=get_client_from_new_t&get_client_info="+encodeURIComponent(t.p),success:function(e){$("#user_info").hide().html(e).fadeIn(500),$("#edit_login").editable({type:"text",pk:1,url:MyHOSTNAME+"actions.php",inputclass:"input-sm",emptytext:"пусто",params:{mode:"verify_login_nt"}}),$("#edit_posada").editable({inputclass:"input-sm",emptytext:"пусто",mode:"popup",showbuttons:!1}),$("#edit_unit").editable({inputclass:"input-sm",emptytext:"пусто",mode:"popup",showbuttons:!1}),$("#edit_tel").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#edit_adr").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#edit_mail").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#for_fio").addClass("has-success"),$("#status_action").val("edit"),n(!0)}})),0==t.res&&(1==t.priv&&($("#user_info").hide(),$("#fio").popover("hide"),$("#for_fio").removeClass("has-error"),$("#for_fio").addClass("has-success"),$("#status_action").val("add"),$.ajax({type:"POST",url:j,data:"mode=get_client_from_new_t&new_client_info="+encodeURIComponent($("#fio").val()),success:function(e){$("#user_info").hide().html(e).fadeIn(500),$("#username").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#new_login").editable({type:"text",pk:1,url:MyHOSTNAME+"actions.php",inputclass:"input-sm",emptytext:"пусто",params:{mode:"verify_login_nt"}}),$("#new_posada").editable({inputclass:"input-sm posada_class",emptytext:"пусто",mode:"popup",showbuttons:!1}),$("#new_unit").editable({inputclass:"input-sm",emptytext:"пусто",mode:"popup",showbuttons:!1}),$("#new_tel").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#new_adr").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#new_mail").editable({inputclass:"input-sm",emptytext:"пусто"}),n(!0)}})),0==t.priv&&($("#user_info").hide(),$("#user_info").hide().html(t.msg_error).fadeIn(500),$("#status_action").val(""),$("#fio").val(""),n(!0)))})}})}})),d("main_stats")&&($("#unitstat_id").select2({allowClear:!0,maximumSelectionSize:15,formatNoMatches:c("JS_not_found")}),$("body").on("click","button#main_stat_make",function(e){e.preventDefault();var t=$("#unitstat_id").val(),o=$("#start_time").val(),a=$("#stop_time").val();$.ajax({type:"POST",url:j,data:"mode=get_total_period_stat&start="+o+"&end="+a+"&unit="+t,success:function(e){$("#ts_res").html(e),$(".knob").knob(),n()}})}),$("#reservation").on("apply.daterangepicker",function(e,t){$("#start_time").val(t.startDate.format("YYYY-MM-DD")),$("#stop_time").val(t.endDate.format("YYYY-MM-DD"))}),$("#reservation").daterangepicker({format:"YYYY-MM-DD"})),d("user_stats")&&($("#user_list").select2({formatResult:i,formatSelection:i,allowClear:!0,maximumSelectionSize:15,width:"100%",formatNoMatches:c("JS_not_found"),escapeMarkup:function(e){return e}}),$("body").on("click","button#user_stat_make",function(e){e.preventDefault();var t=$("#user_list").val(),o=$("#start_time").val(),a=$("#stop_time").val();$.ajax({type:"POST",url:j,data:"mode=get_user_stat&uid="+t+"&start="+o+"&end="+a,success:function(e){$("#content_stat").html(e),$(".knob").knob(),n()}})}),$("#reservation").on("apply.daterangepicker",function(e,t){$("#user_list").val();$("#start_time").val(t.startDate.format("YYYY-MM-DD")),$("#stop_time").val(t.endDate.format("YYYY-MM-DD"))}),$("#reservation").daterangepicker({format:"YYYY-MM-DD"})),d("messages")){interval=setInterval(function(){C()},2e3);var H=$("#content_chat"),E=H[0].scrollHeight;H.scrollTop(E),$("input#msg").bind("keypress",function(e){13==e.keyCode&&$("button#do_comment").click()}),$("input#msg").keyup(function(){$(this).val().replace(/ /g,"").length>1?($("input#msg").popover("hide"),$("#for_msg").removeClass("has-error").addClass("has-success")):($("input#msg").popover("show"),$("#for_msg").addClass("has-error"),setTimeout(function(){$("input#msg").popover("hide")},2e3))}),$("body").on("click","#select_main_chat",function(e){e.preventDefault(),$("#target_user").val("main");var t=$(this).html();$(".user_li").removeClass("active"),$.ajax({type:"POST",url:j,data:"mode=messages_view&target=main",success:function(e){$("#content_chat").html(e),$("input#msg").val(""),n(!0),$("#title_chat").html(t);var o=$("#content_chat"),a=o[0].scrollHeight;o.scrollTop(a)}})}),$("input#find_user").keyup(function(){{var e=$(this).val();$(this).val().length}$.ajax({type:"POST",url:j,data:"mode=message_user_list&t="+e,success:function(e){$("#user_list").html(e)}})}),$("body").on("click",".user_li",function(e){e.preventDefault();var t=$(this).attr("user-id");$(".loading1").addClass("overlay"),$(".loading2").addClass("loading-img"),$(".user_li").removeClass("active"),$(this).addClass("active"),$("#target_user").val(t),$.ajax({type:"POST",url:j,data:"mode=messages_view&target="+t,success:function(e){$("#content_chat").html(e),$("input#msg").val(""),n(!0),$(".loading1").removeClass("overlay"),$(".loading2").removeClass("loading-img");var o=$("#content_chat"),a=o[0].scrollHeight;o.scrollTop(a),$.ajax({type:"POST",url:j,data:"mode=messages_title_username&uid="+t,success:function(e){$("#title_chat").html(e)}}),$.ajax({type:"POST",url:j,data:"mode=recalculate_messages",success:function(e){$("#label_msg").html(e)}});var s="#ul_label_"+t;$.ajax({type:"POST",url:j,data:"mode=recalculate_messages_ul&uid="+t,success:function(e){$(s).html(e),y()}})}})}),$("body").on("click","button#do_comment",function(e){e.preventDefault();{var t=$("#target_user").val();$("input#msg").val().length}$("input#msg").val().replace(/ /g,"").length>1?($("input#msg").popover("hide"),$("#for_msg").removeClass("has-error").addClass("has-success"),$.ajax({type:"POST",url:j,data:"mode=messages_send&textmsg="+encodeURIComponent($("input#msg").val())+"&target="+t,success:function(e){$("#content_chat").html(e),$("input#msg").val(""),n(!0);var t=$("#content_chat"),o=t[0].scrollHeight;t.scrollTop(o)}})):($("input#msg").popover("show"),$("#for_msg").addClass("has-error"),setTimeout(function(){$("input#msg").popover("hide")},2e3))})}if(d("notes")&&$.ajax({type:"POST",url:j,data:"mode=get_list_notes",success:function(e){$("#table_list").html(e),$.ajax({type:"POST",url:j,data:"mode=get_first_note",success:function(){}})}}),d("ticket")){var H=$("#comment_body"),E=H[0].scrollHeight;H.scrollTop(E),$(".file-inputs").bootstrapFileInput(),$("#do_comment_file").change(function(){w()}),U.on("connect_error",function(){$("#ticket_id").val()}),$("body").on("click","button#prio_low",function(e){e.preventDefault(),$("button#prio_low").addClass("active"),$("button#prio_normal").removeClass("active"),$("button#prio_high").removeClass("active"),$("i#lprio_low").addClass("fa fa-check"),$("i#lprio_norm").removeClass("fa fa-check"),$("i#lprio_high").removeClass("fa fa-check"),$("#prio").val("0")}),$("body").on("click","button#prio_normal",function(e){e.preventDefault(),$("button#prio_low").removeClass("active"),$("button#prio_normal").addClass("active"),$("button#prio_high").removeClass("active"),$("i#lprio_low").removeClass("fa fa-check"),$("i#lprio_norm").addClass("fa fa-check"),$("i#lprio_high").removeClass("fa fa-check"),$("#prio").val("1")}),$("body").on("click","button#prio_high",function(e){e.preventDefault(),$("button#prio_low").removeClass("active"),$("button#prio_normal").removeClass("active"),$("button#prio_high").addClass("active"),$("i#lprio_low").removeClass("fa fa-check"),$("i#lprio_norm").removeClass("fa fa-check"),$("i#lprio_high").addClass("fa fa-check"),$("#prio").val("2")}),$("textarea#msg").keyup(function(){$(this).val().length>1?($("textarea#msg").popover("hide"),$("#for_msg").removeClass("has-error").addClass("has-success")):($("textarea#msg").popover("show"),$("#for_msg").addClass("has-error"))}),$("input#msg").bind("keypress",function(e){13==e.keyCode&&$("button#do_comment").click()}),$("input#msg").keyup(function(){$(this).val().replace(/ /g,"").length>1?($("input#msg").popover("hide"),$("#for_msg").removeClass("has-error").addClass("has-success")):($("input#msg").popover("show"),$("#for_msg").addClass("has-error"),setTimeout(function(){$("input#msg").popover("hide")},2e3))}),$("body").on("click","button#action_refer_to",function(e){e.preventDefault();var t=$("#action_refer_to").attr("value");"0"==t&&($("#refer_to").fadeIn(500),$(this).addClass("active").attr("value","1")),"1"==t&&($("#refer_to").fadeOut(500),$(this).removeClass("active").attr("value","0"))}),$("select#t_users_do").change(function(){var e=$("select#t_users_do").val(),t=$("select#t_to").val();0==t&&(0!=e&&$.ajax({type:"POST",url:j,data:"mode=get_unit_id&uid="+e,success:function(e){$("select#t_to [value='"+e+"']").attr("selected","selected"),$("select#t_to").trigger("chosen:updated"),$("#t_for_to").popover("hide"),$("#t_for_to").removeClass("has-error"),$("#t_for_to").addClass("has-success")}}),0==e&&($("select#t_to").find("option:selected").removeAttr("selected"),$("select#t_to").trigger("chosen:updated")))}),$("select#t_to").change(function(){var e=$("select#t_to").val();0!=$("select#t_to").val()?($("#t_for_to").popover("hide"),$("#t_for_to").removeClass("has-error"),r(e,"t_users_do")):0==$("select#t_to").val()&&($("#t_for_to").popover("show"),$("#t_for_to").addClass("has-error"))}),$("body").on("click","button#save_edit_ticket",function(e){e.preventDefault();var t=$("#subj").val(),o=$("#msg_up").val(),a=$("#prio").val(),n=$("#ticket_hash").val();$.ajax({type:"POST",url:j,data:"mode=save_edit_ticket&t_hash="+n+"&subj="+encodeURIComponent(t)+"&prio="+encodeURIComponent(a)+"&msg="+encodeURIComponent(o),success:function(){$("#myModal").modal("hide"),window.location=MyHOSTNAME+"ticket?"+n}})}),$("body").on("click","button#action_ok",function(e){e.preventDefault();var t=$("button#action_ok").attr("status"),o=$("button#action_ok").attr("value"),a=$("button#action_ok").attr("tid"),n=c("JS_ok");if("ok"==t&&($("button#action_ok").attr("status","no_ok").html('<i class="fa fa-check"></i> '+n),$("button#action_lock").removeAttr("disabled"),$("button#action_refer_to").removeAttr("disabled"),$.ajax({type:"POST",url:j,data:"mode=status_ok&tid="+a+"&user="+encodeURIComponent(o),success:function(e){$("#msg").hide().html(e).fadeIn(500),setTimeout(function(){$("#msg").children(".alert").fadeOut(500)},3e3)}})),"no_ok"==t){var s=c("JS_no_ok");$("button#action_lock").attr("disabled","disabled"),$("button#action_refer_to").attr("disabled","disabled"),$("button#action_ok").attr("status","ok").html("<i class=''></i> "+s),$.ajax({type:"POST",url:j,data:"mode=status_no_ok&tid="+a+"&user="+encodeURIComponent(o),success:function(e){$("#msg").hide().html(e).fadeIn(500),setTimeout(function(){$("#msg").children(".alert").fadeOut(500)
},3e3)}})}}),$("body").on("click","button#action_lock",function(e){e.preventDefault();var t=$("button#action_lock").attr("value"),o=$("button#action_lock").attr("tid"),a=$("button#action_lock").attr("status"),n=c("JS_unlock");if("lock"==a&&($("button#action_lock").attr("status","unlock").html("<i class='fa fa-unlock'></i> "+n),$("#msg_e").hide(),$.ajax({type:"POST",url:j,data:"mode=lock&tid="+o+"&user="+encodeURIComponent(t),success:function(e){$("#msg").hide().html(e).fadeIn(500),setTimeout(function(){$("#msg").children(".alert").fadeOut(500)},3e3)}})),"unlock"==a){$("#msg_e").hide();var s=c("JS_lock");$("button#action_lock").attr("status","lock").html("<i class='fa fa-lock'></i> "+s),$.ajax({type:"POST",url:j,data:"mode=unlock&tid="+o,success:function(e){$("#msg").hide().html(e).fadeIn(500),setTimeout(function(){$("#msg").children(".alert").fadeOut(500)},3e3)}})}}),$("body").on("click","button#ref_ticket",function(e){e.preventDefault();var t,o=$("select#t_to").val(),a=($("select#t_users_do").val(),$("#msg1").val());null==$("#t_users_do").val()?t="0":null!=$("#t_users_do").val()&&(t=$("#t_users_do").val());var n=0;if("0"==o&&(n=1,$("#t_for_to").popover("show"),$("#t_for_to").addClass("has-error")),0==n){var s=$("button#ref_ticket").attr("value");$.ajax({type:"POST",url:j,data:"mode=update_to&ticket_id="+s+"&to="+encodeURIComponent(o)+"&tou="+encodeURIComponent(t)+"&tom="+encodeURIComponent(a),success:function(e){$("#ccc").hide().html(e).fadeIn(500),window.location=MyHOSTNAME+"list?in"}})}}),$("body").on("click","button#do_comment",function(e){e.preventDefault();{var t=$(this).attr("value"),o=$(this).attr("user");$("input#msg").val().length}$("input#msg").val().replace(/ /g,"").length>1?($("input#msg").popover("hide"),$("#for_msg").removeClass("has-error").addClass("has-success"),$.ajax({type:"POST",url:j,data:"mode=add_comment&user="+encodeURIComponent(o)+"&textmsg="+encodeURIComponent($("input#msg").val())+"&tid="+t,success:function(e){$("#comment_content").html(e),$("input#msg").val(""),n(!0);var t=$("#comment_body"),o=t[0].scrollHeight;t.scrollTop(o)}})):($("input#msg").popover("show"),$("#for_msg").addClass("has-error"),setTimeout(function(){$("input#msg").popover("hide")},2e3))}),$("#refer_to").hide(),$("#t_users_do").select2({formatResult:i,formatSelection:i,allowClear:!0,maximumSelectionSize:15,width:"100%",formatNoMatches:c("JS_not_found"),escapeMarkup:function(e){return e}}),$("textarea").autosize({append:"\n"}),n(!0)}if(d("userinfo")&&n(!0),d("view_user")&&$(".knob").knob(),d("profile")&&($("input#login_user").keyup(function(){var e=$(this).attr("exclude-param");$(this).val().length>3?($("#login_user_grp").removeClass("has-error").addClass("has-success"),O.login=!1,$.ajax({type:"POST",dataType:"json",url:j,data:"mode=check_login&login="+$(this).val()+"&exclude="+e,success:function(e){$.each(e,function(e,t){1==t.check_login_status?($("#login_user_grp").removeClass("has-error").addClass("has-success"),O.login=!1):0==t.check_login_status&&($("#login_user_grp").addClass("has-error"),O.login=!0)})}})):($("#login_user_grp").addClass("has-error"),O.login=!0)}),$("#file_avatar").change(function(){$("#form_avatar").submit()}),$("body").on("click","button#del_profile_img",function(e){e.preventDefault(),$.ajax({type:"POST",url:j,data:"mode=del_profile_img",success:function(){window.location=MyHOSTNAME+"profile"}})}),$("body").on("click","button#edit_profile_main_client",function(e){e.preventDefault(),$.ajax({type:"POST",url:j,data:"mode=edit_profile_main_client&fio="+encodeURIComponent($("#fio").val())+"&mail="+encodeURIComponent($("#mail").val())+"&lang="+encodeURIComponent($("select#lang").val())+"&skype="+encodeURIComponent($("#skype").val())+"&tel="+encodeURIComponent($("#tel").val())+"&adr="+encodeURIComponent($("#adr").val())+"&id="+encodeURIComponent($("#edit_profile_main").attr("value")),success:function(e){$("#m_info").hide().html(e).fadeIn(500),setTimeout(function(){$("#m_info").children(".alert").fadeOut(500)},3e3)}})}),$("#noty").on("change",function(){var e=this.value;noty({text:"test",layout:e,type:"information",timeout:2e3}),$.ionSound.play("button_tiny")}),$("body").on("click","button#edit_profile_main",function(e){e.preventDefault(),$("#fio").val().length<3&&(O.fio=!0,$("#fio_user_grp").addClass("has-error"));var t=O.fio;0==t?$.ajax({type:"POST",url:j,data:"mode=edit_profile_main&mail="+encodeURIComponent($("#mail").val())+"&fio="+encodeURIComponent($("#fio").val())+"&lang="+encodeURIComponent($("select#lang").val())+"&skype="+encodeURIComponent($("#skype").val())+"&tel="+encodeURIComponent($("#tel").val())+"&adr="+encodeURIComponent($("#adr").val())+"&posada="+encodeURIComponent($("#posada").val())+"&unit="+encodeURIComponent($("#pidrozdil").val())+"&id="+encodeURIComponent($("#edit_profile_main").attr("value"))+"&user_layot="+encodeURIComponent($("#noty").val()),success:function(e){$("#m_info").hide().html(e).fadeIn(500),setTimeout(function(){$("#m_info").children(".alert").fadeOut(500)},3e3)}}):$("html, body").animate({scrollTop:0},"slow")}),$("body").on("click","button#edit_profile_pass",function(e){e.preventDefault(),$.ajax({type:"POST",url:j,data:"mode=edit_profile_pass&old_pass="+encodeURIComponent($("#old_pass").val())+"&new_pass="+encodeURIComponent($("#new_pass").val())+"&new_pass2="+encodeURIComponent($("#new_pass2").val())+"&id="+encodeURIComponent($("#edit_profile_main").attr("value")),success:function(e){$("#p_info").hide().html(e).fadeIn(500),setTimeout(function(){$("#p_info").children(".alert").fadeOut(500)},3e3)}})})),d("create")&&($.fn.editable.defaults.mode="inline",$("#d_finish").daterangepicker({format:"YYYY-MM-DD HH:mm:ss",timePicker:!0,timePicker12Hour:!1,singleDatePicker:!0,minDate:new Date}),$("#d_finish").change(function(){$("#d_finish_val").val($(this).val())}),$("#d_finish").on("apply.daterangepicker",function(e,t){$("#d_finish_val").val(t.startDate.format("YYYY-MM-DD HH:mm:ss"))}),$("select#users_do").change(function(){var e=$("select#users_do").val(),t=$("select#to").val();0==t&&(0!=e&&$.ajax({type:"POST",url:j,data:"mode=get_unit_id&uid="+e,success:function(e){$("select#to [value='"+e+"']").attr("selected","selected"),$("select#to").trigger("chosen:updated"),$("#for_to").popover("hide"),$("#for_to").removeClass("has-error"),$("#for_to").addClass("has-success")}}),0==e&&($("select#to").find("option:selected").removeAttr("selected"),$("select#to").trigger("chosen:updated")))}),$("select#to").on("change",function(){0!=$("select#to").val()?($("#for_to").popover("hide"),$("#for_to").removeClass("has-error"),$("#for_to").addClass("has-success"),$("#dsd").popover("hide")):($("#dsd").popover("show"),$("#for_to").popover("show"),$("#for_to").addClass("has-error"),setTimeout(function(){$("#dsd").popover("hide")},2e3))}),$("select#to").change(function(){var e=$("select#to").val();0!=$("select#to").val()?($("#for_to").popover("hide"),$("#for_to").removeClass("has-error"),$("#for_to").addClass("has-success"),r(e,"users_do")):(r(e,"users_do"),$("#for_to").popover("show"),$("#for_to").addClass("has-error"),setTimeout(function(){$("#for_to").popover("hide")},2e3))}),$("body").on("click","a#select_init_user",function(e){e.preventDefault(),console.log($(this).attr("param-hash"));var t=$("#user_name_login").val(),o=$("#user_init_id").val();$("#fio").popover("hide"),$("#for_fio").removeClass("has-error").addClass("has-success"),$("#user_info").hide().fadeIn(500),$("#alert_add").hide(),$.ajax({type:"POST",url:j,data:"mode=get_client_from_new_t&get_my_info=0",success:function(e){$("#client_id_param").val(o),$("#fio").val(t),$("#user_info").hide().html(e).fadeIn(500),$("#for_fio").addClass("has-success"),$("#status_action").val("edit"),n(!0)}})}),$("body").on("click","button#prio_low",function(e){e.preventDefault(),$("button#prio_low").addClass("active"),$("button#prio_normal").removeClass("active"),$("button#prio_high").removeClass("active"),$("i#lprio_low").addClass("fa fa-check"),$("i#lprio_norm").removeClass("fa fa-check"),$("i#lprio_high").removeClass("fa fa-check"),$("#prio").val("0")}),$("body").on("click","button#prio_normal",function(e){e.preventDefault(),$("button#prio_low").removeClass("active"),$("button#prio_normal").addClass("active"),$("button#prio_high").removeClass("active"),$("i#lprio_low").removeClass("fa fa-check"),$("i#lprio_norm").addClass("fa fa-check"),$("i#lprio_high").removeClass("fa fa-check"),$("#prio").val("1")}),$("body").on("click","button#prio_high",function(e){e.preventDefault(),$("button#prio_low").removeClass("active"),$("button#prio_normal").removeClass("active"),$("button#prio_high").addClass("active"),$("i#lprio_low").removeClass("fa fa-check"),$("i#lprio_norm").removeClass("fa fa-check"),$("i#lprio_high").addClass("fa fa-check"),$("#prio").val("2")}),$("body").on("click","button#enter_ticket_client",function(e){e.preventDefault(),0==S()&&T()}),$("body").on("click","button#enter_ticket",function(e){e.preventDefault(),0==I()&&R()}),$("#fio").autocomplete({max:10,minLength:2,source:MyHOSTNAME+"/inc/json.php?fio",focus:function(e,t){return $("#fio").val(t.item.label),!1},select:function(e,t){return $("#fio").val(t.item.label),$("#client_id_param").val(t.item.value),$("#fio").popover("hide"),$("#for_fio").removeClass("has-error").addClass("has-success"),$("#user_info").hide().fadeIn(500),$("#alert_add").hide(),$.ajax({type:"POST",url:j,data:"mode=get_client_from_new_t&get_client_info="+t.item.value,success:function(e){$("#user_info").hide().html(e).fadeIn(500),$("#edit_login").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#edit_posada").editable({inputclass:"input-sm",emptytext:"пусто",mode:"popup",showbuttons:!1}),$("#edit_unit").editable({inputclass:"input-sm",emptytext:"пусто",mode:"popup",showbuttons:!1}),$("#edit_tel").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#edit_adr").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#edit_mail").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#for_fio").addClass("has-success"),$("#status_action").val("edit"),n(!0)}}),!1},change:function(e,t){0!=$("input#fio").val().length&&null==t.item&&$.ajax({type:"POST",dataType:"json",url:j,data:"mode=find_client&name="+encodeURIComponent($("#fio").val()),success:function(e){$.each(e,function(e,t){1==t.res&&($("#client_id_param").val(t.p),$("#fio").popover("hide"),$("#for_fio").removeClass("has-error").addClass("has-success"),$("#user_info").hide().fadeIn(500),$("#alert_add").hide(),$.ajax({type:"POST",url:j,data:"mode=get_client_from_new_t&get_client_info="+encodeURIComponent(t.p),success:function(e){$("#user_info").hide().html(e).fadeIn(500),$("#edit_login").editable({type:"text",pk:1,url:MyHOSTNAME+"actions.php",inputclass:"input-sm",emptytext:"пусто",params:{mode:"verify_login_nt"}}),$("#edit_posada").editable({inputclass:"input-sm",emptytext:"пусто",mode:"popup",showbuttons:!1}),$("#edit_unit").editable({inputclass:"input-sm",emptytext:"пусто",mode:"popup",showbuttons:!1}),$("#edit_tel").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#edit_adr").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#edit_mail").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#for_fio").addClass("has-success"),$("#status_action").val("edit"),n(!0)}})),0==t.res&&(1==t.priv&&($("#user_info").hide(),$("#fio").popover("hide"),$("#for_fio").removeClass("has-error"),$("#for_fio").addClass("has-success"),$("#status_action").val("add"),$.ajax({type:"POST",url:j,data:"mode=get_client_from_new_t&new_client_info="+encodeURIComponent($("#fio").val()),success:function(e){$("#user_info").hide().html(e).fadeIn(500),$("#username").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#new_login").editable({type:"text",pk:1,url:MyHOSTNAME+"actions.php",inputclass:"input-sm",emptytext:"пусто",params:{mode:"verify_login_nt"}}),$("#new_posada").editable({inputclass:"input-sm posada_class",emptytext:"пусто",mode:"popup",showbuttons:!1}),$("#new_unit").editable({inputclass:"input-sm",emptytext:"пусто",mode:"popup",showbuttons:!1}),$("#new_tel").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#new_adr").editable({inputclass:"input-sm",emptytext:"пусто"}),$("#new_mail").editable({inputclass:"input-sm",emptytext:"пусто"}),n(!0)}})),0==t.priv&&($("#user_info").hide(),$("#user_info").hide().html(t.msg_error).fadeIn(500),$("#status_action").val(""),$("#fio").val(""),n(!0)))})}})}}),$("#user_info").hide(),$("#alert_add").hide(),$("#users_do").select2({formatResult:i,formatSelection:i,allowClear:!0,maximumSelectionSize:15,width:"100%",formatNoMatches:c("JS_not_found"),escapeMarkup:function(e){return e}}),$("textarea").autosize({append:"\n"})),d("notes")&&($("body").on("click","button#save_notes",function(e){e.preventDefault();var t=$(this).attr("value"),o=$("#summernote").code(),a={mode:"save_notes",hn:t,msg:o};$.ajax({type:"POST",url:j,data:a,success:function(){$.ajax({type:"POST",url:j,data:"mode=get_list_notes",success:function(e){$("#table_list").html(e),noty({text:c("note_save"),layout:"center",type:"information",timeout:2e3})}})}})}),$("body").on("click","a#to_notes",function(e){e.preventDefault();var t=$(this).attr("value"),o=(s(),c("JS_save")),a=c("JS_pub");$("#exampleInputEmail1").attr("value",MyHOSTNAME+"/inc/note.php?h="+t),$.ajax({type:"POST",url:j,data:"mode=get_notes&hn="+encodeURIComponent(t),success:function(e){$("#summernote").destroy(),$("#summernote").html(e),$("#buttons").show(),$("#summernote").summernote({height:300,focus:!0,lang:c("summernote_lang"),onImageUpload:function(e,t,o){l(e[0],t,o)},oninit:function(){var e='<button id="save_notes" value="'+t+'" type="button" class="btn btn-success btn-sm btn-small" title="'+o+'" data-event="something" tabindex="-1"><i class="fa fa-check-circle"></i></button>',n='<button id="saveFileBtn" type="button" class="btn btn-warning btn-sm btn-small" title="'+a+'" data-event="something" tabindex="-1" data-toggle="modal" data-target=".bs-example-modal-sm"><i class="fa fa-bullhorn"></i> </button>',s='<div class="note-file btn-group">'+e+n+"</div>";$(s).prependTo($(".note-toolbar")),$("#save_notes").tooltip({container:"body",placement:"bottom"}),$("#saveFileBtn").tooltip({container:"body",placement:"bottom"})}})}})}),$("body").on("click","span#del_notes",function(e){e.preventDefault();var t=$(this).attr("value"),o=c("JS_create"),a=c("JS_del");bootbox.confirm(a,function(e){1==e&&$.ajax({type:"POST",url:j,data:"mode=del_notes&nid="+encodeURIComponent(t),success:function(){$.ajax({type:"POST",url:j,data:"mode=get_list_notes",success:function(e){$("#table_list").html(e),$("#summernote").destroy(),$("#summernote").html('<div class="jumbotron"><p><center>'+o+"</center></p></div>"),$("#buttons").hide()}})}})})}),$("body").on("click","button#create_new_note",function(e){e.preventDefault();var t=c("JS_save"),o=c("JS_pub");$.ajax({type:"POST",url:j,data:"mode=create_notes",success:function(e){{var a=e;s()}$("#exampleInputEmail1").attr("value",MyHOSTNAME+"/inc/note.php?h="+a),$.ajax({type:"POST",url:j,data:"mode=get_notes&hn="+encodeURIComponent(a),success:function(e){$("#summernote").destroy(),$("#summernote").html(e),$("#buttons").show(),$("#summernote").summernote({height:300,focus:!0,lang:c("summernote_lang"),onImageUpload:function(e,t,o){l(e[0],t,o)},oninit:function(){var e='<button id="save_notes" value="'+a+'" type="button" class="btn btn-success btn-sm btn-small" title="'+t+'" data-event="something" tabindex="-1"><i class="fa fa-check-circle"></i></button>',n='<button id="saveFileBtn" type="button" class="btn btn-warning btn-sm btn-small" title="'+o+'" data-event="something" tabindex="-1" data-toggle="modal" data-target=".bs-example-modal-sm"><i class="fa fa-bullhorn"></i> </button>',s='<div class="note-file btn-group">'+e+n+"</div>";$(s).prependTo($(".note-toolbar")),$("#save_notes").tooltip({container:"body",placement:"bottom"}),$("#saveFileBtn").tooltip({container:"body",placement:"bottom"})}})}}),$.ajax({type:"POST",url:j,data:"mode=get_list_notes",success:function(e){$("#table_list").html(e)}})}})}),$("#buttons").hide()),d("files"),d("helper")&&(0!=$("#summernote_help").length&&$("#summernote_help").summernote({height:300,focus:!0,lang:c("summernote_lang"),onImageUpload:function(e,t,o){l(e[0],t,o)}}),$("body").on("click","button#del_helper",function(e){e.preventDefault();var t=$(this).val(),o=c("JS_del");bootbox.confirm(o,function(e){1==e&&$.ajax({type:"POST",url:j,data:"mode=del_help&hn="+t,success:function(){$.ajax({type:"POST",url:j,data:"mode=list_help",success:function(){window.location=MyHOSTNAME+"helper"}})}})})}),$("input#find_helper").keyup(function(){var e=$(this).val();$(this).val().length>1?$.ajax({type:"POST",url:j,data:"mode=find_help&t="+e,success:function(e){$("#help_content").html(e)}}):$(this).val().length<2&&$.ajax({type:"POST",url:j,data:"mode=view_cats",success:function(e){$("#help_content").html(e)}})}),x(),$("body").on("click","button#add_helper_item",function(e){e.preventDefault(),$.ajax({type:"POST",url:j,data:"mode=items_view",success:function(e){$("#content_items").html(e),x()}})}),$("body").on("click","i#del_item_no",function(e){e.preventDefault();var t=c("JS_HELPER_error_to_del");noty({text:t,layout:"center",type:"information",timeout:3e3})}),$("body").on("click","i#del_item",function(e){e.preventDefault();var t=$(this).attr("value");bootbox.confirm(c("JS_del"),function(e){1==e&&$.ajax({type:"POST",url:j,data:"mode=helper_item_del&id="+t,success:function(e){$("#content_items").html(e),x()}}),0==e&&console.log("false")})}),$("body").on("click","button#do_save_help",function(e){e.preventDefault();var t=$("#summernote_help").code(),o=$(this).val(),a=$("#u").chosen().val(),n=$("#is_client").prop("checked"),s=c("JS_unit"),i=c("JS_probl"),l=$("#t").val(),r=$("#cat").val(),d={mode:"do_save_help",u:a,t:l,msg:t,hn:o,is_client:n,cat_id:r},u=0;null==a&&(u=1,noty({text:s,layout:"center",type:"information",timeout:2e3})),0==$("#t").val().length&&(u=1,noty({text:i,layout:"center",type:"information",timeout:2e3})),0==u&&$.ajax({type:"POST",url:j,data:d,success:function(){window.location=MyHOSTNAME+"helper"}})}),$("body").on("click","button#do_create_help",function(e){e.preventDefault();var t=$("#summernote_help").code(),o=$("#u").chosen().val(),a=c("JS_unit"),n=c("JS_probl"),s=$("#is_client").prop("checked"),i=$("#t").val(),l=$("#cat").val(),r={mode:"do_create_help",u:o,t:i,msg:t,is_client:s,cat:l},d=0;null==o&&(d=1,noty({text:a,layout:"center",type:"information",timeout:2e3})),0==$("#t").val().length&&(d=1,noty({text:n,layout:"center",type:"information",timeout:2e3})),0==d&&$.ajax({type:"POST",url:j,data:r,success:function(){window.location=MyHOSTNAME+"helper"}})}),$.ajax({type:"POST",url:j,data:"mode=view_cats",success:function(e){$("#help_content").html(e)}})),d("stats"),d("create")){$("textarea#msg").keyup(function(){$(this).val().length>1?($("textarea#msg").popover("hide"),$("#for_msg").removeClass("has-error").addClass("has-success")):($("textarea#msg").popover("show"),setTimeout(function(){$("textarea#msg").popover("hide")},2e3),$("#for_msg").addClass("has-error"))}),$("select#subj").change(function(){0==$("select#subj").val()?($("#for_subj").popover("show"),setTimeout(function(){$("#for_subj").popover("hide")},2e3),$("#for_subj").addClass("has-error")):null==$("select#subj").val()?($("#for_subj").popover("show"),setTimeout(function(){$("#for_subj").popover("hide")},2e3),$("#for_subj").addClass("has-error")):($("#for_subj").popover("hide"),$("#for_subj").removeClass("has-error").addClass("has-success"))}),$("body").on("click","button#reset_ticket",function(e){e.preventDefault(),window.location=MyHOSTNAME+"create"});var A=new RegExp("(.|/)"+$("input#file_types").val());jQuery().fileupload&&$("#fileupload").fileupload({url:MyHOSTNAME+"sys/index.php",autoUpload:!0,disableValidation:!1,acceptFileTypes:A,maxFileSize:$("input#file_size").val(),formData:{hashname:$("input#hashname").val()}}).on("fileuploadprocessalways",function(){$(this).removeClass("fileupload-processing")}).on("fileuploaddone",function(e,t){$.each(t.result.files,function(e,o){if(o.url){var a=$("<a>").attr("target","_blank").prop("href",o.url);$(t.context.children()[e]).wrap(a)}else if(o.error){var n=$('<span class="text-danger"/>').text(o.error);$(t.context.children()[e]).append("<br>").append(n)}})}).on("fileuploadstop",function(){}).on("fileuploadadd",function(){}).on("fileuploadsubmit",function(e,t){console.log(t)})}if(d("list")){$("body").on("click","button#action_list_ok",function(e){e.preventDefault();var t=$(this).attr("status"),o=$(this).attr("value"),a="#tr_"+o,n=$(this).attr("user");"ok"==t&&($(this).attr("status","unok"),$(this).html('<i class="fa fa-check-circle-o"></i>'),$.ajax({type:"POST",url:j,data:"mode=status_no_ok&tid="+o+"&user="+encodeURIComponent(n),success:function(){$(a).removeClass().addClass("success",1e3).addClass("pops")}})),"unok"==t&&($(this).attr("status","ok"),$(this).html('<i class="fa fa-circle-o"></i>'),$.ajax({type:"POST",url:j,data:"mode=status_ok&tid="+o+"&user="+encodeURIComponent(n),success:function(){$(a).removeClass("success",1e3)}}))}),$("body").on("click","button#action_arch_now",function(e){e.preventDefault();var t=$(this).attr("value"),o="#tr_"+t;$.ajax({type:"POST",url:j,data:"mode=arch_now&tid="+t,success:function(){$(o).fadeOut(500)}})}),$("body").on("click","button#action_list_lock",function(e){e.preventDefault();var t=$(this).attr("status"),o=$(this).attr("value"),a="#tr_"+o,n=$(this).attr("user");"lock"==t&&($(this).attr("status","unlock"),$(this).html('<i class="fa fa-lock"></i>'),$.ajax({type:"POST",url:j,data:"mode=lock&tid="+o+"&user="+encodeURIComponent(n),success:function(){$(a).removeClass().addClass("warning",1e3),$(a).addClass("pops")}})),"unlock"==t&&($(this).attr("status","lock"),$(this).html('<i class="fa fa-unlock"></i>'),$.ajax({type:"POST",url:j,data:"mode=unlock&tid="+o,success:function(){$(a).removeClass("warning",1e3)}}))}),$("body").on("click","button#sort_list",function(e){e.preventDefault();var t=$("#page_type").attr("value"),o=$(this).attr("value");$.ajax({type:"POST",url:j,data:"mode=sort_list&pt="+encodeURIComponent(t)+"&st="+encodeURIComponent(o),success:function(){window.location=MyHOSTNAME+"list?"+t}})}),$("body").on("click","button#list_set_ticket",function(e){e.preventDefault();var t=$("#page_type").attr("value"),o=$(this).text();$.ajax({type:"POST",url:j,data:"mode=set_list_count&pt="+encodeURIComponent(t)+"&v="+encodeURIComponent(o),success:function(){window.location=MyHOSTNAME+"list?"+t}})}),$('[data-toggle="tooltip"]').tooltip({container:"body",html:!0});var N={currentPage:$("#cur_page").val(),totalPages:$("#total_pages").val(),bootstrapMajorVersion:3,size:"small",itemContainerClass:function(e,t,o){return t===o?"active":"pointer-cursor"},onPageClicked:function(e,t,o,a){var s=$("#curent_page").attr("value");a!=s&&($("#spinner").fadeIn(300),$("#curent_page").attr("value",a),$.ajax({type:"POST",url:MyHOSTNAME+"inc/client.list_content.inc.php",data:"menu=out&page="+encodeURIComponent(a),success:function(e){$("#content").hide().html(e).fadeIn(500),$("#spinner").hide(),$('[data-toggle="tooltip"]').tooltip({container:"body",html:!0}),n(!0)}}))}};$("#example_client").bootstrapPaginator(N);var Y={currentPage:$("#cur_page").val(),totalPages:$("#total_pages").val(),bootstrapMajorVersion:3,size:"small",itemContainerClass:function(e,t,o){return t===o?"active":"pointer-cursor"},onPageClicked:function(e,t,o,s){var i=$("#curent_page").attr("value");s!=i&&($("#curent_page").attr("value",s),$("#spinner").fadeIn(300),$.ajax({type:"POST",url:MyHOSTNAME+"inc/list_content.inc.php",data:"menu=in&page="+encodeURIComponent(s),success:function(e){$("#content").hide().html(e).fadeIn(500),$("#spinner").hide(),$('[data-toggle="tooltip"]').tooltip({container:"body",html:!0}),a(),n(!0)}}))}},z={currentPage:$("#cur_page").val(),totalPages:$("#total_pages").val(),bootstrapMajorVersion:3,size:"small",itemContainerClass:function(e,t,o){return t===o?"active":"pointer-cursor"},onPageClicked:function(e,t,o,s){var i=$("#curent_page").attr("value");s!=i&&($("#spinner").fadeIn(300),$("#curent_page").attr("value",s),$.ajax({type:"POST",url:MyHOSTNAME+"inc/list_content.inc.php",data:"menu=out&page="+encodeURIComponent(s),success:function(e){$("#content").hide().html(e).fadeIn(500),$("#spinner").hide(),$('[data-toggle="tooltip"]').tooltip({container:"body",html:!0}),a(),n(!0)}}))}},J={currentPage:$("#cur_page").val(),totalPages:$("#total_pages").val(),bootstrapMajorVersion:3,size:"small",itemContainerClass:function(e,t,o){return t===o?"active":"pointer-cursor"},onPageClicked:function(e,t,o,s){var i=$("#curent_page").attr("value");s!=i&&($("#curent_page").attr("value",s),$("#spinner").fadeIn(300),$.ajax({type:"POST",url:MyHOSTNAME+"inc/list_content.inc.php",data:"menu=arch&page="+encodeURIComponent(s),success:function(e){$("#content").hide().html(e).fadeIn(500),$("#spinner").hide(),$('[data-toggle="tooltip"]').tooltip({container:"body",html:!0}),a(),n(!0)}}))}},F={currentPage:$("#cur_page").val(),totalPages:$("#total_pages").val(),bootstrapMajorVersion:3,size:"small",itemContainerClass:function(e,t,o){return t===o?"active":"pointer-cursor"},onPageClicked:function(e,t,o,s){var i=$("#curent_page").attr("value");s!=i&&($("#spinner").fadeIn(300),$("#curent_page").attr("value",s),$.ajax({type:"POST",url:MyHOSTNAME+"inc/client.list_content.inc.php",data:"menu=out&page="+encodeURIComponent(s),success:function(e){$("#content").hide().html(e).fadeIn(500),$("#spinner").hide(),$('[data-toggle="tooltip"]').tooltip({container:"body",html:!0}),a(),n(!0)}}))}};$("#example_in").bootstrapPaginator(Y),$("#example_out").bootstrapPaginator(z),$("#example_arch").bootstrapPaginator(J),$("#client_example_out").bootstrapPaginator(F)}if(d("config")&&($("select#to").on("change",function(){0!=$("select#to").val()?($("#for_to").popover("hide"),$("#dsd").popover("hide")):($("#dsd").popover("show"),$("#for_to").popover("show"),setTimeout(function(){$("#dsd").popover("hide")},2e3))}),$("select#to").change(function(){var e=$("select#to").val();0!=$("select#to").val()?($("#for_to").popover("hide"),r(e,"users_do")):(r(e,"users_do"),$("#for_to").popover("show"),setTimeout(function(){$("#for_to").popover("hide")},2e3))}),$("#users_do").select2({formatResult:i,formatSelection:i,allowClear:!0,maximumSelectionSize:15,width:"100%",formatNoMatches:c("JS_not_found"),escapeMarkup:function(e){return e}}),$("select#users_do").change(function(){var e=$("select#users_do").val(),t=$("select#to").val();0==t&&(0!=e&&$.ajax({type:"POST",url:j,data:"mode=get_unit_id&uid="+e,success:function(e){$("select#to [value='"+e+"']").attr("selected","selected"),$("select#to").trigger("chosen:updated"),$("#for_to").popover("hide")}}),0==e&&($("select#to").find("option:selected").removeAttr("selected"),$("select#to").trigger("chosen:updated")))}),$("input[type=radio][name=optionsRadios1]").on("ifChanged",function(){console.log(this.value),"0"==this.value?$("#to_msg").prop("disabled",!1).trigger("chosen:updated"):"1"==this.value&&$("#to_msg").prop("disabled",!0).trigger("chosen:updated")}),$("#to_msg").chosen({max_selected_options:50}),$("body").on("click","button#conf_edit_global_message",function(e){e.preventDefault(),$.ajax({type:"POST",url:j,data:"mode=conf_edit_gm&status="+encodeURIComponent($("#gm_active").val())+"&to_msg="+encodeURIComponent($("input[type=radio][name=optionsRadios1]:checked").val())+"&usr_list="+encodeURIComponent($("#to_msg").val())+"&msg_type="+encodeURIComponent($("input[type=radio][name=optionsRadios_msg]:checked").val())+"&gm_text="+encodeURIComponent($("#gm_text").val()),success:function(e){$("#conf_edit_gm_res").hide().html(e).fadeIn(500),setTimeout(function(){$("#conf_edit_gm_res").children(".alert").fadeOut(500)},3e3)}})}),$("#file_logo").change(function(){$("#form_logo").submit()}),$("body").on("click","button#del_logo_img",function(e){e.preventDefault(),$.ajax({type:"POST",url:j,data:"mode=del_logo_img",success:function(){window.location=MyHOSTNAME+"config"}})}),$("body").on("click","button#check_update",function(e){e.preventDefault(),$.ajax({type:"POST",url:j,data:"mode=check_version",success:function(e){$("#result_update").hide().html(e).fadeIn(500),setTimeout(function(){$("#result_update").children(".alert").fadeOut(500)},3e3)}})}),$("select#mail_type").change(function(){"sendmail"==$("select#mail_type").val()?$("#smtp_div").hide():"SMTP"==$("select#mail_type").val()&&$("#smtp_div").show()}),$("body").on("click","button#conf_edit_pb",function(e){e.preventDefault(),$.ajax({type:"POST",url:j,data:"mode=conf_edit_pb&api="+encodeURIComponent($("input#pb_api").val()),success:function(e){$("#conf_edit_pb_res").hide().html(e).fadeIn(500),setTimeout(function(){$("#conf_edit_pb_res").children(".alert").fadeOut(500)},3e3)}})}),$("body").on("click","button#conf_edit_ticket",function(e){e.preventDefault(),$.ajax({type:"POST",url:j,data:"mode=conf_edit_ticket&days2arch="+encodeURIComponent($("input#days2arch").val())+"&fix_subj="+encodeURIComponent($("#fix_subj").val())+"&file_uploads="+encodeURIComponent($("#file_uploads").val())+"&file_types="+encodeURIComponent($("#file_types").val())+"&file_size="+encodeURIComponent(1024*$("#file_size").val()*1024)+"&ticket_last_time="+encodeURIComponent($("#ticket_last_time").val()),dataType:"json",success:function(e){$.each(e,function(e,t){1==t.res?($("#conf_edit_ticket_res").hide().html(t.msg).fadeIn(500),setTimeout(function(){$("#conf_edit_ticket_res").children(".alert").fadeOut(500)},3e3)):0==t.res&&$("#conf_edit_ticket_res").hide().html(t.msg).fadeIn(500)})}})}),$("body").on("click","button#conf_edit_main",function(e){e.preventDefault(),$.ajax({type:"POST",url:j,data:"mode=conf_edit_main&name_of_firm="+encodeURIComponent($("input#name_of_firm").val())+"&title_header="+encodeURIComponent($("input#title_header").val())+"&ldap="+encodeURIComponent($("input#ldap_ip").val())+"&ldapd="+encodeURIComponent($("input#ldap_domain").val())+"&hostname="+encodeURIComponent($("input#hostname").val())+"&mail="+encodeURIComponent($("input#mail").val())+"&first_login="+encodeURIComponent($("#first_login").val())+"&node_port="+encodeURIComponent($("#node_port").val())+"&time_zone="+encodeURIComponent($("#time_zone").val())+"&allow_register="+encodeURIComponent($("#allow_register").val())+"&lang="+encodeURIComponent($("#lang").val()),dataType:"json",success:function(e){$.each(e,function(e,t){1==t.res?($("#conf_edit_main_res").hide().html(t.msg).fadeIn(500),setTimeout(function(){$("#conf_edit_main_res").children(".alert").fadeOut(500)},3e3)):0==t.res&&$("#conf_edit_main_res").hide().html(t.msg).fadeIn(500)})}})}),$("body").on("click","button#conf_test_mail",function(e){e.preventDefault(),$.ajax({type:"POST",url:j,data:"mode=conf_edit_mail&mail_active="+encodeURIComponent($("#mail_active").val())+"&host="+encodeURIComponent($("#host").val())+"&port="+encodeURIComponent($("#port").val())+"&auth="+encodeURIComponent($("#auth").val())+"&auth_type="+encodeURIComponent($("#auth_type").val())+"&username="+encodeURIComponent($("#username").val())+"&password="+encodeURIComponent($("#password").val())+"&from="+encodeURIComponent($("#from").val())+"&type="+encodeURIComponent($("#mail_type").val()),success:function(e){$("#conf_edit_mail_res").hide().html(e).fadeIn(500),setTimeout(function(){$("#conf_edit_mail_res").children(".alert").fadeOut(500)},3e3),$.ajax({type:"POST",url:j,data:"mode=conf_test_mail",success:function(e){$("#conf_test_mail_res").html(e)}})}})}),$("body").on("click","button#conf_edit_mail",function(e){e.preventDefault(),$.ajax({type:"POST",url:j,data:"mode=conf_edit_mail&mail_active="+encodeURIComponent($("#mail_active").val())+"&host="+encodeURIComponent($("#host").val())+"&port="+encodeURIComponent($("#port").val())+"&auth="+encodeURIComponent($("#auth").val())+"&auth_type="+encodeURIComponent($("#auth_type").val())+"&username="+encodeURIComponent($("#username").val())+"&password="+encodeURIComponent($("#password").val())+"&from="+encodeURIComponent($("#from").val())+"&type="+encodeURIComponent($("#mail_type").val()),success:function(e){$("#conf_edit_mail_res").hide().html(e).fadeIn(500),setTimeout(function(){$("#conf_edit_mail_res").children(".alert").fadeOut(500)
},3e3)}})}),$("body").on("click","button#conf_edit_email_gate",function(e){e.preventDefault(),$.ajax({type:"POST",url:j,data:"mode=conf_edit_email_gate&email_gate_status="+$("#email_gate_status").val()+"&email_gate_all="+$("#email_gate_all").val()+"&to="+$("#to").val()+"&users_do="+$("#users_do").val()+"&email_gate_mailbox="+$("#email_gate_mailbox").val()+"&email_gate_filter="+$("#email_gate_filter").val()+"&email_gate_host="+$("#email_gate_host").val()+"&email_gate_cat="+$("#email_gate_cat").val()+"&email_gate_port="+$("#email_gate_port").val()+"&email_gate_login="+$("#email_gate_login").val()+"&email_gate_pass="+$("#email_gate_pass").val(),success:function(e){$("#conf_edit_email_gate_res").hide().html(e).fadeIn(500),setTimeout(function(){$("#conf_edit_email_gate_res").children(".alert").fadeOut(500)},3e3)}})}),"sendmail"==$("select#mail_type").val()?$("#smtp_div").hide():"SMTP"==$("select#mail_type").val()&&$("#smtp_div").show()),d("deps")&&($.fn.editable.defaults.mode="inline",$("a#edit_deps").each(function(e,t){$(t).editable({inputclass:"input-sm",emptytext:"пусто",params:{mode:"edit_deps"}})}),$("body").on("click","button#deps_del",function(e){e.preventDefault();var t=$(this).attr("value");bootbox.confirm(c("JS_del"),function(e){1==e&&$.ajax({type:"POST",url:j,data:"mode=deps_del&id="+t,success:function(e){$("#content_deps").html(e),$("a#edit_deps").each(function(e,t){$(t).editable({inputclass:"input-sm",emptytext:"пусто",params:{mode:"edit_deps"}})})}}),0==e&&console.log("false")})}),$("body").on("click","button#deps_add",function(e){e.preventDefault(),$.ajax({type:"POST",url:j,data:"mode=deps_add&text="+encodeURIComponent($("#deps_text").val()),success:function(e){$("#content_deps").html(e),$("#deps_text").val(""),$("a#edit_deps").each(function(e,t){$(t).editable({inputclass:"input-sm",emptytext:"пусто",params:{mode:"edit_deps"}})})}})}),$("body").on("click","button#deps_show",function(e){e.preventDefault();var t=$(this).attr("value");$.ajax({type:"POST",url:j,data:"mode=deps_show&id="+t,success:function(){window.location=MyHOSTNAME+"deps"}})}),$("body").on("click","button#deps_hide",function(e){e.preventDefault();var t=$(this).attr("value");$.ajax({type:"POST",url:j,data:"mode=deps_hide&id="+t,success:function(){window.location=MyHOSTNAME+"deps"}})})),d("files")&&$("body").on("click","button#files_del",function(e){e.preventDefault();var t=$(this).attr("value");bootbox.confirm(c("JS_del"),function(e){1==e&&$.ajax({type:"POST",url:j,data:"mode=files_del&id="+t,success:function(){window.location=MyHOSTNAME+"files"}})})}),d("units")&&($("body").on("click","button#units_del",function(e){e.preventDefault();var t=$(this).attr("value");bootbox.confirm(c("JS_del"),function(e){1==e&&$.ajax({type:"POST",url:j,data:"mode=units_del&id="+t,success:function(e){$("#content_units").html(e)}})})}),$("body").on("click","button#units_add",function(e){e.preventDefault(),$.ajax({type:"POST",url:j,data:"mode=units_add&text="+encodeURIComponent($("#units_text").val()),success:function(e){$("#content_units").html(e),$("#units_text").val("")}})})),d("users")){$('[data-toggle="tooltip"]').tooltip({container:"body",html:!0}),$("body").on("click","button#make_logout_user",function(e){e.preventDefault();var t=$(this).attr("value");$.ajax({type:"POST",url:j,data:"mode=push_msg_action2user&user="+encodeURIComponent(t)+"&op=logout",success:function(){window.location=MyHOSTNAME+"users"}})}),$("input#fio_find_admin").keyup(function(){{var e=$(this).val();$(this).val().length}$.ajax({type:"POST",url:MyHOSTNAME+"/inc/users.inc.php",data:"menu=list&page=1&t="+e,success:function(e){$("#content_users").html(e),$('[data-toggle="tooltip"]').tooltip({container:"body",html:!0})}})}),$("#my-select").select2({allowClear:!0,maximumSelectionSize:15,width:"100%",formatNoMatches:c("JS_not_found")});var V={currentPage:$("#cur_page").val(),totalPages:$("#total_pages").val(),bootstrapMajorVersion:3,size:"small",itemContainerClass:function(e,t,o){return t===o?"active":"pointer-cursor"},onPageClicked:function(e,t,o,a){var n=$("#curent_page").attr("value");a!=n&&($("#curent_page").attr("value",a),$.ajax({type:"POST",url:MyHOSTNAME+"inc/users.inc.php",data:"page="+encodeURIComponent(a)+"&menu=list",success:function(e){$("#content_users").hide().html(e).fadeIn(500),$('[data-toggle="tooltip"]').tooltip({container:"body",html:!0})}}))}};$("#example_users").bootstrapPaginator(V),$("input#exampleInputPassword1").keyup(function(){$(this).val().length>3?(O.pass=!1,$("#pass_user_grp").removeClass("has-error").addClass("has-success")):(O.pass=!0,$("#pass_user_grp").removeClass("has-success").addClass("has-error"))}),$("#ldap_auth_key").on("ifChanged",function(){$(this).is(":checked")?$("#exampleInputPassword1").prop("disabled",!0):$("#exampleInputPassword1").prop("disabled",!1)}),$("input[type=radio][name=optionsRadios]").on("ifChanged",function(){"0"==this.value?($("#priv_add_client").iCheck("enable"),$("#priv_edit_client").iCheck("enable"),$("#my-select").prop("disabled",!1)):"1"==this.value?($("#priv_add_client").iCheck("enable"),$("#priv_edit_client").iCheck("enable"),$("#my-select").prop("disabled",!1)):"2"==this.value?($("#priv_add_client").iCheck("enable"),$("#priv_edit_client").iCheck("enable"),$("#my-select").prop("disabled",!1)):"4"==this.value&&($("#priv_add_client").iCheck("disable"),$("#priv_edit_client").iCheck("disable"),$("#my-select").prop("disabled",!0))}),$("input#login_user").keyup(function(){$(this).val().length>3?($("#login_user_grp").removeClass("has-error").addClass("has-success"),O.login=!1,$.ajax({type:"POST",dataType:"json",url:j,data:"mode=check_login&login="+$(this).val(),success:function(e){$.each(e,function(e,t){1==t.check_login_status?($("#login_user_grp").removeClass("has-error").addClass("has-success"),O.login=!1):0==t.check_login_status&&($("#login_user_grp").addClass("has-error"),O.login=!0)})}})):($("#login_user_grp").addClass("has-error"),O.login=!0)}),$("input#login_user2").keyup(function(){var e=$(this).attr("exclude-param");$(this).val().length>3?($("#login_user_grp").removeClass("has-error").addClass("has-success"),O.login=!1,$.ajax({type:"POST",dataType:"json",url:j,data:"mode=check_login&login="+$(this).val()+"&exclude="+e,success:function(e){$.each(e,function(e,t){1==t.check_login_status?($("#login_user_grp").removeClass("has-error").addClass("has-success"),O.login=!1):0==t.check_login_status&&($("#login_user_grp").addClass("has-error"),O.login=!0)})}})):($("#login_user_grp").addClass("has-error"),O.login=!0)}),$("input#fio_user").keyup(function(){$(this).val().length>3?(O.fio=!1,$("#fio_user_grp").removeClass("has-error").addClass("has-success")):(O.fio=!0,$("#fio_user_grp").removeClass("has-success").addClass("has-error"))}),$("body").on("click","button#create_user",function(e){e.preventDefault(),$("#fio_user").val().length<3&&(O.fio=!0,$("#fio_user_grp").addClass("has-error")),$("#exampleInputPassword1").val().length<3&&(O.pass=!0,$("#pass_user_grp").addClass("has-error")),$("#login_user").val().length<3&&(O.login=!0,$("#login_user_grp").addClass("has-error"));var t=O.login||O.fio||O.pass;0==t?$.ajax({type:"POST",url:j,data:"mode=add_user&fio="+encodeURIComponent($("#fio_user").val())+"&login="+encodeURIComponent($("#login_user").val())+"&pass="+encodeURIComponent($("#exampleInputPassword1").val())+"&unit="+encodeURIComponent($("#my-select").val())+"&priv="+encodeURIComponent($("input[type=radio][name=optionsRadios]:checked").val())+"&ldap_auth_key="+encodeURIComponent($("#ldap_auth_key").prop("checked"))+"&mess="+encodeURIComponent($("textarea#mess").val())+"&mess_t="+encodeURIComponent($("input#msg_title").val())+"&push="+encodeURIComponent($("input#push").val())+"&tel="+encodeURIComponent($("input#tel").val())+"&skype="+encodeURIComponent($("input#skype").val())+"&adr="+encodeURIComponent($("input#adr").val())+"&posada="+encodeURIComponent($("#posada").val())+"&pidrozdil="+encodeURIComponent($("#pidrozdil").val())+"&lang="+encodeURIComponent($("select#lang").val())+"&priv_add_client="+encodeURIComponent($("#priv_add_client").prop("checked"))+"&priv_edit_client="+encodeURIComponent($("#priv_edit_client").prop("checked"))+"&mail="+encodeURIComponent($("#mail").val())+"&msg_type="+encodeURIComponent($("input[type=radio][name=optionsRadios_msg]:checked").val()),success:function(){window.location=MyHOSTNAME+"users?create&ok"}}):$("html, body").animate({scrollTop:0},"slow")}),$("body").on("click","button#edit_user",function(e){e.preventDefault();var t=$(this).attr("value");$.ajax({type:"POST",url:j,data:"mode=edit_user&fio="+encodeURIComponent($("#fio_user").val())+"&login="+encodeURIComponent($("#login_user2").val())+"&pass="+encodeURIComponent($("#exampleInputPassword1").val())+"&unit="+encodeURIComponent($("#my-select").val())+"&priv="+encodeURIComponent($("input[type=radio][name=optionsRadios]:checked").val())+"&ldap_auth_key="+encodeURIComponent($("#ldap_auth_key").prop("checked"))+"&mess="+encodeURIComponent($("textarea#mess").val())+"&mess_t="+encodeURIComponent($("input#msg_title").val())+"&push="+encodeURIComponent($("input#push").val())+"&tel="+encodeURIComponent($("input#tel").val())+"&skype="+encodeURIComponent($("input#skype").val())+"&adr="+encodeURIComponent($("input#adr").val())+"&posada="+encodeURIComponent($("#posada").val())+"&pidrozdil="+encodeURIComponent($("#pidrozdil").val())+"&lang="+encodeURIComponent($("select#lang").val())+"&priv_add_client="+encodeURIComponent($("#priv_add_client").prop("checked"))+"&priv_edit_client="+encodeURIComponent($("#priv_edit_client").prop("checked"))+"&mail="+encodeURIComponent($("#mail").val())+"&status="+encodeURIComponent($("#lock").val())+"&idu="+encodeURIComponent(t)+"&msg_type="+encodeURIComponent($("input[type=radio][name=optionsRadios_msg]:checked").val()),success:function(){window.location=MyHOSTNAME+"users?edit="+t+"&ok"}})})}if(d("subj")&&($("body").on("click","button#subj_del",function(e){e.preventDefault();var t=$(this).attr("value");bootbox.confirm(c("JS_del"),function(e){1==e&&$.ajax({type:"POST",url:j,data:"mode=subj_del&id="+t,success:function(e){$("#content_subj").html(e)}})})}),$("body").on("click","button#subj_add",function(e){e.preventDefault(),$.ajax({type:"POST",url:j,data:"mode=subj_add&text="+encodeURIComponent($("#subj_text").val()),success:function(e){$("#content_subj").html(e),$("#subj_text").val("")}})})),d("clients")){$("body").on("click","button#create_user_approve",function(e){e.preventDefault(),$("#res").html(""),$.ajax({type:"POST",url:j,data:"mode=add_user_approve&fio="+encodeURIComponent($("#fio_user").val())+"&login="+encodeURIComponent($("#login_user").val())+"&tel="+encodeURIComponent($("input#tel").val())+"&skype="+encodeURIComponent($("input#skype").val())+"&adr="+encodeURIComponent($("input#adr").val())+"&posada="+encodeURIComponent($("#posada").val())+"&pidrozdil="+encodeURIComponent($("#pidrozdil").val())+"&mail="+encodeURIComponent($("#mail").val()),dataType:"json",success:function(e){$.each(e,function(e,t){1==t.res?window.location=MyHOSTNAME+"clients?add&ok":0==t.res&&$("#res").html(t.msg)})}})}),$("body").on("click","button#edit_user_approve",function(e){e.preventDefault();var t=$(this).attr("value");$.ajax({type:"POST",url:j,data:"mode=edit_user_approve&fio="+encodeURIComponent($("#fio_user").val())+"&login="+encodeURIComponent($("#login_user2").val())+"&tel="+encodeURIComponent($("input#tel").val())+"&skype="+encodeURIComponent($("input#skype").val())+"&adr="+encodeURIComponent($("input#adr").val())+"&posada="+encodeURIComponent($("#posada").val())+"&pidrozdil="+encodeURIComponent($("#pidrozdil").val())+"&cid="+encodeURIComponent(t)+"&mail="+encodeURIComponent($("#mail").val()),dataType:"json",success:function(e){$.each(e,function(e,o){1==o.res?window.location=MyHOSTNAME+"clients?edit="+t+"&ok":0==o.res&&$("#res").html(o.msg)})}})}),$("input#fio_find_admin").keyup(function(){{var e=$(this).val();$(this).val().length}$.ajax({type:"POST",url:MyHOSTNAME+"/inc/clients.inc.php",data:"menu=list&page=1&t="+e,success:function(e){$("#content_clients").html(e)}})});var L={currentPage:$("#cur_page").val(),totalPages:$("#total_pages").val(),bootstrapMajorVersion:3,size:"small",itemContainerClass:function(e,t,o){return t===o?"active":"pointer-cursor"},onPageClicked:function(e,t,o,a){var n=$("#curent_page").attr("value");a!=n&&($("#curent_page").attr("value",a),$.ajax({type:"POST",url:MyHOSTNAME+"inc/clients.inc.php",data:"page="+encodeURIComponent(a)+"&menu=list",success:function(e){$("#content_clients").hide().html(e).fadeIn(500),$('[data-toggle="tooltip"]').tooltip({container:"body",html:!0})}}))}};$("#example_clients").bootstrapPaginator(L)}d("posada")&&($("body").on("click","button#posada_add",function(e){e.preventDefault(),$.ajax({type:"POST",url:j,data:"mode=posada_add&text="+encodeURIComponent($("#posada_text").val()),success:function(e){$("#content_posada").html(e),$("#posada_text").val("")}})}),$("body").on("click","button#posada_del",function(e){e.preventDefault();var t=$(this).attr("value");bootbox.confirm(c("JS_del"),function(e){1==e&&$.ajax({type:"POST",url:j,data:"mode=posada_del&id="+t,success:function(e){$("#content_posada").html(e)}})})})),d("approve")&&($("body").on("click","button#action_aprove_yes",function(e){e.preventDefault();var t=$(this).attr("value"),o=".table_"+t;$.ajax({type:"POST",url:j,data:"mode=aprove_yes&id="+encodeURIComponent(t),success:function(){$(o).fadeOut(500)}})}),$("body").on("click","button#action_aprove_no",function(e){e.preventDefault();var t=$(this).attr("value"),o=".table_"+t;$.ajax({type:"POST",url:j,data:"mode=aprove_no&id="+encodeURIComponent(t),success:function(){$(o).fadeOut(500)}})})),("index.php"==D||window.location==MyHOSTNAME)&&($("body").on("click","button#dashboard_set_ticket",function(e){e.preventDefault();var t=$(this).text();$.ajax({type:"POST",url:j,data:"mode=dashboard_t&p="+encodeURIComponent(t),success:function(e){$("#spinner").show(),$("#dashboard_t").html(e),$("#spinner").hide(),$('[data-toggle="tooltip"]').tooltip("hide"),$('[data-toggle="tooltip"]').tooltip({container:"body",html:!0}),n(!0),a()}})}),$("body").on("click","a#more_news",function(e){e.preventDefault();$(this).attr("value");$.ajax({type:"POST",url:j,data:"mode=last_news&v="+encodeURIComponent($(this).attr("value")),success:function(e){$("#last_news").html(e),$('[data-toggle="tooltip"]').tooltip("hide"),$('[data-toggle="tooltip"]').tooltip({container:"body",html:!0}),n(!1)}})}),$.ajax({type:"POST",url:j,data:"mode=last_news",success:function(e){$("#last_news").html(e),n(!1)}}),$("#spinner").show(),$.ajax({type:"POST",url:j,data:"mode=dashboard_t",success:function(e){$("#dashboard_t").html(e),$("#spinner").hide(),$('[data-toggle="tooltip"]').tooltip({container:"body",html:!0}),n(!0),a()}})),$("body").on("click","a#go_back",function(e){e.preventDefault(),history.back(1)}),$("body").on("click","a#print_t",function(){window.print()})});